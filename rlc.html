

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RLC &mdash; Rulebook documentation 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e259d695"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Building RLC from sources" href="building.html" />
    <link rel="prev" title="Graphic engines and machine learning" href="project_rationale.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Rulebook documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Concepts:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language_tour.html">Language Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_inversion_of_control_problem.html">Interactive Inversion of control</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_rationale.html">Graphic engines and machine learning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">RLC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#command-line-options">Command line options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introspection-options">Introspection options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-generation">Output generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compilation-flags">Compilation flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-lsp-and-autocomplete">rlc-lsp and autocomplete</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vscode">VSCODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vim-with-youcompleteme">VIM with YouCompleteMe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-test">rlc-test</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-random">rlc-random</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-learn">rlc-learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-play">rlc-play</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-probs">rlc-probs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-action">rlc-action</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tools-for-compiler-people">Tools for compiler people</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlc-internals">RLC internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lexer">Lexer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parser">Parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unchecked-ast">Unchecked AST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#typechecked-ast">Typechecked AST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implicit-instantiation">Implicit instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flattened">Flattened</a></li>
<li class="toctree-l3"><a class="reference internal" href="#action-rewriting">Action rewriting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lowering-to-llvm-ir">Lowering to LLVM IR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-ir-more-readable">Making IR more readable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mlir">MLIR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-single-rlc-passes">Running single RLC passes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building RLC from sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="interoperating.html">Interoperation with engines and languages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reinforcement Learning Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial for RL people</a></li>
<li class="toctree-l1"><a class="reference internal" href="gym_tutorial.html">RLC and GYM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UIs, Controllers, Gameplay:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ui_gameplay.html">UI, Controller, and Gameplay</a></li>
<li class="toctree-l1"><a class="reference internal" href="4hammer.html">4Hammer</a></li>
<li class="toctree-l1"><a class="reference internal" href="board_games.html">Board games</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language-reference.html">Rulebook Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib/index.html">stdlib</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rulebook documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">RLC</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/rlc.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rlc">
<h1>RLC<a class="headerlink" href="#rlc" title="Link to this heading"></a></h1>
<p>This document describes the architecture of <code class="docutils literal notranslate"><span class="pre">RLC</span></code>, the rulebook compiler, and of the other tools of the RLC suite. The intent is to provide a high level description of how the various parts of Rulebook fit into a product built on top of it, as well as a description of RLC command line facilities. More exhaustive descriptions of all tools can be found in the <a class="reference internal" href="language-reference.html"><span class="std std-doc">reference</span></a>.</p>
<p>RLC is a <a class="reference external" href="https://llvm.org">LLVM</a> based compiler, it ingest one or more rulebook files and various possible outputs depending on the user request.</p>
<div class="graphviz"><img src="_images/graphviz-af7e321713df6766eb45f70dd8af6c88d2777649.png" alt="digraph RLC_Compiler {
    /*––Layout––*/
    rankdir = LR;
    nodesep = 0.6;
    ranksep = 1;

    /*––Global node / edge styling––*/
    node [shape=box, style=filled, color=&quot;#dddddd&quot;,
          fontname=&quot;Helvetica&quot;, fontsize=10];
    edge [arrowsize=0.7];

    /*––Input &amp; compiler––*/
    rl_file [label=&quot;file.rl&quot;,
             shape=note, style=&quot;filled,rounded&quot;,
             color=&quot;#8ecae6&quot;, fontcolor=&quot;#0a3045&quot;];
    rlc     [label=&quot;rlc&quot;,
             shape=box3d, color=&quot;#219ebc&quot;, fontcolor=&quot;white&quot;];

    /*––Outputs, all kept on the same vertical line––*/
    subgraph cluster_outputs { rank=same;
        executable [label=&quot;Executable&quot;];
        shared     [label=&quot;Shared Library&quot;];
        static     [label=&quot;Static Library&quot;];
        header     [label=&quot;header.h&quot;];
        godot      [label=&quot;Godot-CPP Module&quot;];
        csharp     [label=&quot;C# Wrapper&quot;];
        python     [label=&quot;Python Wrapper&quot;];
    }

    /*––Edges––*/
    rl_file -&gt; rlc;

    rlc -&gt; executable;
    rlc -&gt; shared  ;
    rlc -&gt; static ;
    rlc -&gt; header;
    rlc -&gt; godot;
    rlc -&gt; csharp  ;
    rlc -&gt; python;
}" class="graphviz" /></div>
<p>RLC produces:</p>
<ul class="simple">
<li><p><strong>native executable</strong>, pretty much the same as the output of a c/cpp file compiled with clang.</p></li>
<li><p>native libraries to reuse in other languages.</p></li>
<li><p>a wrapper to use the library in that language.</p></li>
</ul>
<section id="command-line-options">
<h2>Command line options<a class="headerlink" href="#command-line-options" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rlc</span></code> executable supports a large number of command line flags.  Most of
them mirror the options of typical C/C++ compilers.  The options can be grouped
in a few categories: <strong>introspection</strong>, <strong>output generation</strong>, <strong>compilation</strong> and
<strong>miscellaneous</strong> features.  Below is a short description of every available
flag.</p>
<section id="introspection-options">
<h3>Introspection options<a class="headerlink" href="#introspection-options" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--token</span></code> – lex the input file and print the token stream.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--dot</span></code> – dump the action graph in GraphViz format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--graph</span></code> – dump a machine parsable description of the action graph.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--graph-filter</span> <span class="pre">&lt;regex&gt;</span></code> – print only actions whose name matches the regular
expression.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--graph-only-actions</span></code> – omit non action functions from the dumped graphs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--graph-inline</span></code> – inline calls inside the graph visualization.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--unchecked</span></code> – print the AST before type checking and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--type-checked</span></code> – print the AST after type checking but before template
expansion and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--before-template</span></code> – dump the IR just before templates are instantiated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--after-implicit</span></code> – dump the IR after implicit instantiation has completed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--flattened</span></code> – dump the IR after control flow has been flattened.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--rlc</span></code> – print the final RLC IR and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ir</span></code> – dump the generated LLVM IR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--mlir</span></code> – dump the MLIR representation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--print-ir-on-failure</span></code> – if compilation fails, print the IR that caused the
failure.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--timing</span></code> – print the time taken by each compiler pass.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--hide-position</span></code> – do not print file and line information in IR dumps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--hide-dl</span></code> – do not print the module data layout in IR dumps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--print-included-files</span></code> – instead of compiling, print the contents of all
files included during parsing.  Use <code class="docutils literal notranslate"><span class="pre">--hide-standard-lib-files</span></code> to omit files
coming from the standard library.</p></li>
</ul>
</section>
<section id="output-generation">
<h3>Output generation<a class="headerlink" href="#output-generation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--header</span></code> – emit a C header describing the compiled module and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--c-sharp</span></code> – emit a C# wrapper and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--python</span></code> – emit a Python wrapper and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--godot</span></code> – emit a wrapper for Godot and exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--compile</span></code> – generate an object file without linking.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--shared</span></code> – produce a shared library instead of an executable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">&lt;file&gt;</span></code> – path of the output file to generate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--clang</span> <span class="pre">&lt;path&gt;</span></code> – path to the <code class="docutils literal notranslate"><span class="pre">clang</span></code> binary used for linking.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--rpath</span> <span class="pre">&lt;path&gt;</span></code> – add an rpath entry to the produced binary (may be repeated).</p></li>
</ul>
</section>
<section id="compilation-flags">
<h3>Compilation flags<a class="headerlink" href="#compilation-flags" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-O2</span></code> – enable optimizations and disable runtime checks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span></code> – generate debug information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--emit-precondition-checks</span></code> – insert checks for function preconditions
(enabled by default, disabled by <code class="docutils literal notranslate"><span class="pre">-O2</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--emit-bound-checks</span></code> – insert array bounds checks (enabled by default,
disabled by <code class="docutils literal notranslate"><span class="pre">-O2</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--sanitize</span></code> – enable runtime sanitizer instrumentation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--fuzzer</span></code> – build the program as a fuzzer; implies <code class="docutils literal notranslate"><span class="pre">--sanitize</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--fuzzer-lib</span> <span class="pre">&lt;path&gt;</span></code> – path to the library implementing the fuzzer runtime.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pylib</span></code> – link against the Python interpreter.  When enabled assertions use
the symbol <code class="docutils literal notranslate"><span class="pre">rl_py_abort</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pyrlc-lib</span> <span class="pre">&lt;path&gt;</span></code> – path to the Python wrapper support library; enables
<code class="docutils literal notranslate"><span class="pre">--pylib</span></code> automatically.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--runtime-lib</span> <span class="pre">&lt;path&gt;</span></code> – path to the Rulebook runtime library.  If omitted the
compiler uses the runtime distributed with <code class="docutils literal notranslate"><span class="pre">rlc</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--target</span> <span class="pre">&lt;triple&gt;</span></code> – override the default target triple.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--abort-symbol</span> <span class="pre">&lt;name&gt;</span></code> – specify the symbol to call when an assertion fails.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--MD</span></code> – generate a makefile style dependency file alongside the output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--expect-fail</span></code> – return exit code 0 if compilation fails and 1 on success
(useful in tests).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--verbose</span></code>/<code class="docutils literal notranslate"><span class="pre">-v</span></code> – print verbose information while invoking external tools.</p></li>
</ul>
</section>
<section id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;dir&gt;</span></code> – additional include directories searched when resolving imports.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pylib</span></code> and <code class="docutils literal notranslate"><span class="pre">--pyrlc-lib</span></code> – support linking against Python as described
above.</p></li>
<li><p>Extra object files or additional <code class="docutils literal notranslate"><span class="pre">.rl</span></code> sources can be passed on the command
line after the main input file.  Directories specified with <code class="docutils literal notranslate"><span class="pre">-i</span></code> are searched
for imported files.</p></li>
</ul>
</section>
</section>
<section id="rlc-lsp-and-autocomplete">
<h2>rlc-lsp and autocomplete<a class="headerlink" href="#rlc-lsp-and-autocomplete" title="Link to this heading"></a></h2>
<p>rlc-lsp is a <a class="reference external" href="https://en.wikipedia.org/wiki/Language_Server_Protocol">language server</a> for the Rulebook language. It allows users to get autocomplete in their ide.</p>
<p>Notice that rlc-lsp must be in PATH, so if you are using the PIP package of rulebook, you must start your editor from the shell that has already enabled the virtual environment that installed rl_language or rl_language_core.</p>
<section id="vscode">
<h3>VSCODE<a class="headerlink" href="#vscode" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">vscode</span></code> has a plugin available in the plugin store called <code class="docutils literal notranslate"><span class="pre">rl-lsp</span></code> and <code class="docutils literal notranslate"><span class="pre">rl-language</span></code> that enables autocomplete and syntax highlighting.</p>
</section>
<section id="vim-with-youcompleteme">
<h3>VIM with YouCompleteMe<a class="headerlink" href="#vim-with-youcompleteme" title="Link to this heading"></a></h3>
<p>On <code class="docutils literal notranslate"><span class="pre">vim</span></code>, if you use <code class="docutils literal notranslate"><span class="pre">YouCompleteMe</span></code> you can get access to automplete by adding the following to your .vimrc file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">au</span> <span class="n">BufRead</span><span class="p">,</span><span class="n">BufNewFile</span> <span class="o">*.</span><span class="n">rl</span> <span class="nb">set</span> <span class="n">filetype</span><span class="o">=</span><span class="n">rl</span>

<span class="n">let</span> <span class="n">g</span><span class="p">:</span><span class="n">ycm_language_server</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span>
            \    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;rulebook&#39;</span><span class="p">,</span>
            \     <span class="s1">&#39;cmdline&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;rlc-lsp&#39;</span><span class="p">,</span> <span class="s1">&#39;--stdio&#39;</span> <span class="p">],</span>
            \     <span class="s1">&#39;filetypes&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;rl&#39;</span> <span class="p">]</span>
            \   <span class="p">}]</span>

</pre></div>
</div>
</section>
</section>
<section id="rlc-test">
<h2>rlc-test<a class="headerlink" href="#rlc-test" title="Link to this heading"></a></h2>
<p>rlc-test runs all functions with no arguments found in the input file that return a bool called test_* .</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">fun</span> <span class="n">test_return_success</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Bool</span><span class="p">:</span>
    <span class="kr">return</span> <span class="l">true</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rlc-test<span class="w"> </span>file.rl
</pre></div>
</div>
<p>This program is only available in a pip installation.</p>
</section>
<section id="rlc-random">
<h2>rlc-random<a class="headerlink" href="#rlc-random" title="Link to this heading"></a></h2>
<p>rlc-random runs random actions on a program with a finite amount of actions, and does until it reaches the end of the program. It prints the selected actions.</p>
<p>This tool is useful as a command line utility to quickly test a interactive program, or to produce a trace useful to some other program.</p>
<p>To be usable with rlc-random, a program just requires that to have a entry point with the following signature <code class="docutils literal notranslate"><span class="pre">act</span> <span class="pre">play()</span> <span class="pre">-&gt;</span> <span class="pre">Game</span></code>, and that all <code class="docutils literal notranslate"><span class="pre">action</span> <span class="pre">statements</span></code> that appear in <code class="docutils literal notranslate"><span class="pre">play</span></code> are enumerable.</p>
<p>This program is only available in a pip installation.</p>
</section>
<section id="rlc-learn">
<h2>rlc-learn<a class="headerlink" href="#rlc-learn" title="Link to this heading"></a></h2>
<p>rlc-learn uses an off-the-shelf implementation of PPO to maximize some metric in a given Rulebook program. This tool is intended to be used to perform sanity checks by those that wish to roll out their own machine learning algorithm, or by those that do not have knowledge of reinforcement learning and wish to use an acceptable off-the-shelf implementation. A basic tutorial is shown <a class="reference internal" href="tutorial.html"><span class="std std-doc">here</span></a>.</p>
<p>The command accepts a number of options controlling how the program is
compiled and how the training loop behaves.  All options from
<code class="docutils literal notranslate"><span class="pre">make_rlc_argparse</span></code> are available together with a set of flags specific to
reinforcement learning.  The following list explains each option in depth:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--include</span></code>/<code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;dir&gt;</span></code> – add <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code> to the search path for additional
<code class="docutils literal notranslate"><span class="pre">.rl</span></code> files when compiling the environment.  Use this when your Rulebook
program imports modules stored in other directories.  The flag may appear
multiple times and each directory is forwarded to the compiler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--stdlib</span> <span class="pre">&lt;dir&gt;</span></code> – path to an alternative Rulebook standard library.
By default the version bundled with the installed package is used.  Specify
this option if you maintain a custom copy of the standard library or if you
are experimenting with modifications.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pyrlc</span> <span class="pre">&lt;path&gt;</span></code> – location of the Python wrapper runtime library.
The wrapper produced by <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--python</span></code> depends on this support library.
Normally it is found automatically but installations in unusual locations may
require setting this path explicitly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--rlc</span></code>/<code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;path&gt;</span></code> – path to the <code class="docutils literal notranslate"><span class="pre">rlc</span></code> compiler executable.  If the compiler
is not available in your <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, for instance when using a development build,
point this flag to the desired executable so <code class="docutils literal notranslate"><span class="pre">rlc-learn</span></code> can invoke it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--runtime</span></code>/<code class="docutils literal notranslate"><span class="pre">-rt</span> <span class="pre">&lt;path&gt;</span></code> – path to a custom Rulebook runtime library to link
against.  Use this to train with an instrumented runtime or an experimental
build instead of the one shipped with the package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--extra-rlc-args</span> <span class="pre">&lt;args&gt;</span></code> – additional command line arguments forwarded
verbatim to <code class="docutils literal notranslate"><span class="pre">rlc</span></code>.  Any string placed here is appended to the compilation
command.  Typical uses include enabling optimizations (<code class="docutils literal notranslate"><span class="pre">-O2</span></code>) or runtime
sanitizers without modifying the learning script.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output</span></code>/<code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">&lt;file&gt;</span></code> – file where the trained network is written.  After
training completes the model parameters are saved in PyTorch format at this
location.  The resulting file can be passed to <code class="docutils literal notranslate"><span class="pre">rlc-play</span></code> or <code class="docutils literal notranslate"><span class="pre">rlc-probs</span></code> and
defaults to <code class="docutils literal notranslate"><span class="pre">network</span></code> when omitted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--no-tensorboard</span></code> – do not launch the TensorBoard server.  By default
<code class="docutils literal notranslate"><span class="pre">rlc-learn</span></code> starts TensorBoard on port <code class="docutils literal notranslate"><span class="pre">6006</span></code> and logs reward and loss curves
for real‑time monitoring.  Disable it in headless or resource constrained
setups.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--total-steps</span> <span class="pre">&lt;n&gt;</span></code> – total number of environment interactions collected
before training ends.  Increasing this budget allows the algorithm to gather
more experience and usually yields a stronger policy, albeit at the cost of
longer training time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--lr</span> <span class="pre">&lt;value&gt;</span></code> – learning rate used by the optimizer.  This controls the
step size of gradient updates and heavily influences training stability.
Values are typically between <code class="docutils literal notranslate"><span class="pre">1e-3</span></code> and <code class="docutils literal notranslate"><span class="pre">1e-5</span></code> depending on the environment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--entropy-coeff</span> <span class="pre">&lt;value&gt;</span></code> – weight of the entropy bonus encouraging
exploration.  A larger coefficient drives the agent to sample actions more
uniformly, helping exploration but delaying convergence if set too high.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--clip-param</span> <span class="pre">&lt;value&gt;</span></code> – PPO clipping threshold.  This bounds the change in
action probabilities between successive updates.  Small values lead to very
conservative updates while larger ones allow faster but less stable learning.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--league-play</span></code> – periodically save networks and pit the agent against older
versions to prevent forgetting.  This self-play mechanism exposes the model to
past behaviors so new strategies do not overwrite previously learned skills.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load</span> <span class="pre">&lt;file&gt;</span></code> – start training from the checkpoint in <code class="docutils literal notranslate"><span class="pre">&lt;file&gt;</span></code> rather than
from scratch.  Use this option to continue a previous run or fine tune an
existing model on a new task.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--steps-per-env</span> <span class="pre">&lt;n&gt;</span></code> – number of steps collected in each environment before
a gradient update (default <code class="docutils literal notranslate"><span class="pre">100</span></code>).  Larger values increase the batch size used
for optimization and can improve stability, but they also raise memory
requirements.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--hypersearch</span></code> – run a predefined hyperparameter search over learning rate,
entropy coefficient, clip parameter and the number of steps per environment.
Results for each configuration are stored in separate directories to simplify
comparison.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--model-save-frequency</span> <span class="pre">&lt;n&gt;</span></code> – write a checkpoint every <code class="docutils literal notranslate"><span class="pre">&lt;n&gt;</span></code> iterations
(default <code class="docutils literal notranslate"><span class="pre">20</span></code>).  Frequent checkpoints let you inspect intermediate policies
or resume training after unexpected interruptions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--envs</span> <span class="pre">&lt;n&gt;</span></code> – number of parallel environments used to gather experience.
Each environment runs in its own process and contributes samples
simultaneously.  Higher values speed up data collection but demand more CPU
time and memory.</p></li>
</ul>
<p>This program is only available in a pip installation.</p>
</section>
<section id="rlc-play">
<h2>rlc-play<a class="headerlink" href="#rlc-play" title="Link to this heading"></a></h2>
<p>Given a Rulebook program file.rl, and the network obtained from <code class="docutils literal notranslate"><span class="pre">rlc-learn</span> <span class="pre">file.rl</span></code>, rlc-play generates a playout of that environment from start to finish according to the probabilities assigned by the network. A basic tutorial is shown <a class="reference internal" href="tutorial.html"><span class="std std-doc">here</span></a>.</p>
<p>This program is only available in a pip installation.</p>
</section>
<section id="rlc-probs">
<h2>rlc-probs<a class="headerlink" href="#rlc-probs" title="Link to this heading"></a></h2>
<p>rlc-probs uses the network generated by rlc-learn to display on screen the actions available to the network in a given state of the input interactive program, and their respective probabilities. This tool is intended to be use to inspect the decision making skills of a trained network, beside gaining more insight than observing a single decision at the time.</p>
<p>A basic tutorial is shown <a class="reference internal" href="tutorial.html"><span class="std std-doc">here</span></a>.</p>
<p>This program is only available in a pip installation.</p>
</section>
<section id="rlc-action">
<h2>rlc-action<a class="headerlink" href="#rlc-action" title="Link to this heading"></a></h2>
<p>Applies a execution trace to a rulebook program, and then prints the final result. This tool is useful to check if a trace is valid, if the traced program is correct.</p>
<p>The command accepts the standard compilation flags exposed by
<code class="docutils literal notranslate"><span class="pre">make_rlc_argparse</span></code> together with a few options controlling how the trace is
executed.  Below is a description of every available flag:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source_file</span></code> – path to the <code class="docutils literal notranslate"><span class="pre">.rl</span></code> source file (or a Python wrapper produced
with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--python</span></code>) to run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">action_file</span></code> – text file containing one action per line.  Use <code class="docutils literal notranslate"><span class="pre">-</span></code> to read
from standard input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load</span></code>/<code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">&lt;file&gt;</span></code> – load a previously saved binary state before applying
the actions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output</span></code>/<code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">&lt;file&gt;</span></code> – write the final state to <code class="docutils literal notranslate"><span class="pre">&lt;file&gt;</span></code> in binary format
instead of printing it on screen.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ignore-invalid</span></code>/<code class="docutils literal notranslate"><span class="pre">-ii</span></code> – skip actions that fail to parse or cannot be
applied rather than stopping with an error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--print-all</span></code>/<code class="docutils literal notranslate"><span class="pre">-all</span></code> – echo each line from the trace before executing it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pretty-print</span></code>/<code class="docutils literal notranslate"><span class="pre">-pp</span></code> – pause after each action and pretty print the current
state, waiting for user input to continue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--show-actions</span></code>/<code class="docutils literal notranslate"><span class="pre">-a</span></code> – list all available actions defined in the program and
exit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--include</span></code>/<code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;dir&gt;</span></code> – additional include directories used when compiling
the Rulebook program.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--stdlib</span> <span class="pre">&lt;dir&gt;</span></code> – path to a custom standard library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pyrlc</span> <span class="pre">&lt;path&gt;</span></code> – location of the Python wrapper runtime library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--rlc</span></code>/<code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;path&gt;</span></code> – explicit path to the <code class="docutils literal notranslate"><span class="pre">rlc</span></code> compiler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--runtime</span></code>/<code class="docutils literal notranslate"><span class="pre">-rt</span> <span class="pre">&lt;path&gt;</span></code> – alternative runtime library to link against.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--extra-rlc-args</span> <span class="pre">&lt;args&gt;</span></code> – extra command line arguments forwarded verbatim
to <code class="docutils literal notranslate"><span class="pre">rlc</span></code> during compilation.</p></li>
</ul>
<p>This program is only available in a pip installation.</p>
</section>
<section id="tools-for-compiler-people">
<h2>Tools for compiler people<a class="headerlink" href="#tools-for-compiler-people" title="Link to this heading"></a></h2>
<p>This section of the document talks about the internal components of RLC, and is meant for compiler developers, not users of the language. If you are confused about what this means and you are wondering if this section is for your, it is not, although you can still read it if you are interested in knowing what goes on under rlc hood.</p>
</section>
<section id="rlc-internals">
<h2>RLC internals<a class="headerlink" href="#rlc-internals" title="Link to this heading"></a></h2>
<p>RLC is a <a class="reference external" href="https://llvm.org">LLVM</a> and <a class="reference external" href="https://mlir.llvm.org">MLIR</a> based compiler. It has a custom recursive descent parser, and a custom AST built on top of MLIR, called the RLC Dialect.</p>
<div class="graphviz"><img src="_images/graphviz-9a6be1fc809ecb1bbc57774bce5c92edb8b876d7.png" alt="digraph RLC_Pipeline_V {
    rankdir = TB;           /* vertical (top-to-bottom) layout          */
    nodesep = 0.6;
    ranksep = 1;
    dpi     = 100;          /* higher resolution                        */

    node [shape=box, style=filled, color=&quot;#dddddd&quot;,
          fontname=&quot;Helvetica&quot;, fontsize=11];
    edge [arrowsize=0.7];

    /* main pipeline */
    lexer                 [label=&quot;Lexer&quot;];
    parser                [label=&quot;Parser&quot;];
    unchecked_ast         [label=&quot;Unchecked AST&quot;];
    typechecked_ast       [label=&quot;Typechecked AST&quot;];
    implicit_instantiation[label=&quot;Implicit Instantiation&quot;];
    flattened             [label=&quot;Flattened&quot;];
    action_rewriting      [label=&quot;Action Rewriting&quot;];
    llvm_ir               [label=&quot;LLVM IR&quot;];
    file_a                [label=&quot;file.a&quot;];
    linker                [label=&quot;Linker&quot;];
    lib_so                [label=&quot;lib.so&quot;];

    /* auxiliary */
    libruntime [label=&quot;libruntime&quot;, shape=note,
                style=&quot;filled,rounded&quot;, color=&quot;#8ecae6&quot;,
                fontcolor=&quot;#0a3045&quot;];
    wrappers   [label=&quot;Wrappers&quot;];

    /* sequential flow */
    lexer  -&gt; parser
    parser -&gt; unchecked_ast
    unchecked_ast -&gt; typechecked_ast
    typechecked_ast -&gt; implicit_instantiation
    implicit_instantiation -&gt; flattened
    flattened -&gt; action_rewriting
    action_rewriting -&gt; llvm_ir
    llvm_ir -&gt; file_a
    file_a  -&gt; linker
    linker  -&gt; lib_so

    /* extra edges */
    libruntime -&gt; linker ;
    implicit_instantiation -&gt; wrappers;
}" class="graphviz" /></div>
<section id="lexer">
<h3>Lexer<a class="headerlink" href="#lexer" title="Link to this heading"></a></h3>
<p>The lexer of RLC takes the input file and turns them into token to be consumed by the parser. There is nothing fancy here except that since the language has semantical whitespaces, the lexer must keep track of the indentation.</p>
<p>You can see the token stream with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--token</span> <span class="pre">file.rl</span></code></p>
</section>
<section id="parser">
<h3>Parser<a class="headerlink" href="#parser" title="Link to this heading"></a></h3>
<p>The parser is a recursive descent handwritten parser, the parser takes the tokens, and creates on the fly the unchecked AST.</p>
</section>
<section id="unchecked-ast">
<h3>Unchecked AST<a class="headerlink" href="#unchecked-ast" title="Link to this heading"></a></h3>
<p>Before typechecking the AST of the language is unchecked, it means that almost every non trivial operation is marked as having unknown type.</p>
<p>You can see the token stream with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--unchecked</span> <span class="pre">file.rl</span></code></p>
</section>
<section id="typechecked-ast">
<h3>Typechecked AST<a class="headerlink" href="#typechecked-ast" title="Link to this heading"></a></h3>
<p>The typechecked IR knows all types of all expressions, except for templates, which have been typechecked, but are not expanded yet.</p>
<p>Ideally, all static errors in the input program should be discovered during typechecking. In practice this is true for every error except errors relating to <code class="docutils literal notranslate"><span class="pre">drop</span></code>, <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">assign</span></code> when they are used inside templates.</p>
<p>You can see the token stream with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--type-checked</span> <span class="pre">file.rl</span></code></p>
</section>
<section id="implicit-instantiation">
<h3>Implicit instantiation<a class="headerlink" href="#implicit-instantiation" title="Link to this heading"></a></h3>
<p>During the implicit instantiation step templates end up being generated, and implicit init, drop and assign functions emitted.</p>
<p>After the implicit step, no object of the module can be a template, and all non external declared entities must have been discovered.</p>
<p>You can see the token stream with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--after-implicit</span> <span class="pre">file.rl</span></code></p>
<p>Wrappers for other languages are emitted after this step, when all concrete functions are accounted for.</p>
</section>
<section id="flattened">
<h3>Flattened<a class="headerlink" href="#flattened" title="Link to this heading"></a></h3>
<p>During the flattening step all control flow constructs are removed and replaced with jumps.</p>
<p>You can see the token stream with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--flattened</span> <span class="pre">file.rl</span></code></p>
</section>
<section id="action-rewriting">
<h3>Action rewriting<a class="headerlink" href="#action-rewriting" title="Link to this heading"></a></h3>
<p>During action rewriting all Action Functions <code class="docutils literal notranslate"><span class="pre">act</span> <span class="pre">$name()</span> <span class="pre">-&gt;</span> <span class="pre">$Type:</span></code> end up being replaced with the functions they declare. This includes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">$name()</span> <span class="pre">-&gt;</span> <span class="pre">$Type:</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">can_$name()</span> <span class="pre">-&gt;</span> <span class="pre">Bool:</span></code> if the action function <code class="docutils literal notranslate"><span class="pre">$name</span></code> has a precondition.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">$act($Type,</span> <span class="pre">args...)</span></code> for each action statement called <code class="docutils literal notranslate"><span class="pre">$act</span></code> in <code class="docutils literal notranslate"><span class="pre">$name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">can_$act($Type,</span> <span class="pre">args...)</span> <span class="pre">-&gt;</span> <span class="pre">Bool</span></code> for each action statement called <code class="docutils literal notranslate"><span class="pre">$act</span></code> in <code class="docutils literal notranslate"><span class="pre">$name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">is_done($Type)</span> <span class="pre">-&gt;</span> <span class="pre">Bool</span></code></p></li>
</ul>
<p>After action rewrting the module contains only types and functions.</p>
</section>
<section id="lowering-to-llvm-ir">
<h3>Lowering to LLVM IR<a class="headerlink" href="#lowering-to-llvm-ir" title="Link to this heading"></a></h3>
<p>The module is translated to LLVM IR to be optimized and compiled.</p>
<p>You can see the token stream with <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--ir</span> <span class="pre">file.rl</span></code> to see the LLVM ir. You can use <code class="docutils literal notranslate"><span class="pre">rlc</span> <span class="pre">--ir</span> <span class="pre">file.rl</span> <span class="pre">-O2</span></code> if you want to see the optimized IR.</p>
</section>
<section id="making-ir-more-readable">
<h3>Making IR more readable<a class="headerlink" href="#making-ir-more-readable" title="Link to this heading"></a></h3>
<p>When printing the RLC IR you can pass <code class="docutils literal notranslate"><span class="pre">--hide-positions</span></code> and <code class="docutils literal notranslate"><span class="pre">--hide-dl</span></code> to omit the module data layout and the module debug positions. That makes the IR slightly more readable.</p>
</section>
<section id="mlir">
<h3>MLIR<a class="headerlink" href="#mlir" title="Link to this heading"></a></h3>
<p>I know you are looking for a explanation of how MLIR works since MLIR documentation is arcane. Good luck!</p>
<p>Once you figure it out: RLC uses MLIR as a mere intermediate rappresentation generator, and as a way to convert to LLVM IR. We use nothing about Dialect interoperability or tensorial stuff. Every MLIR operation we use(except when converting to LLVM IR) is custom made for RLC.</p>
<p>In practice what we get out MLIR is:</p>
<ul class="simple">
<li><p>the pipeline infrastructure</p></li>
<li><p>the declarative way of creating new operation types</p></li>
<li><p>the textual serializers for MLIR</p></li>
<li><p>mlir-opt which runs single passes of mlir</p></li>
<li><p>some basic type interfaces</p></li>
<li><p>MLIR dataflow analysis</p></li>
</ul>
</section>
<section id="running-single-rlc-passes">
<h3>Running single RLC passes<a class="headerlink" href="#running-single-rlc-passes" title="Link to this heading"></a></h3>
<p>If you want to run a RLC pass in isolation after a particular step of the rlc pipeline, say the typechecking step, you can run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rlc</span> <span class="o">--</span><span class="nb">type</span><span class="o">-</span><span class="n">checked</span> <span class="n">file</span><span class="o">.</span><span class="n">rl</span> <span class="o">-</span><span class="n">o</span> <span class="o">-</span> <span class="o">|</span> <span class="n">rlc</span><span class="o">-</span><span class="n">opt</span> <span class="o">--</span><span class="n">PASS_NAME</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="project_rationale.html" class="btn btn-neutral float-left" title="Graphic engines and machine learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="building.html" class="btn btn-neutral float-right" title="Building RLC from sources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Massimo Fioravanti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>