

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UI, Controller and Gameplay &mdash; Rulebook documentation 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e259d695"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4Hammer" href="4hammer.html" />
    <link rel="prev" title="RLC and GYM" href="gym_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Rulebook documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Concepts:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language_tour.html">Language Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_inversion_of_control_problem.html">Interactive Inversion of control</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_rationale.html">Graphic engines and machine learning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rlc.html">RLC</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building RLC from sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="interoperating.html">Interoperation with engines and languages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reinforcement Learning Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial for RL people</a></li>
<li class="toctree-l1"><a class="reference internal" href="gym_tutorial.html">RLC and GYM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UIs, Controllers, Gameplay:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">UI, Controller and Gameplay</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mvc">MVC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model">Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#view">View</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controller">Controller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#view-rulebook-pattern">VIEW-Rulebook pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#efficient-view-rulebook-pattern">Efficient VIEW-Rulebook pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#view-rulebook-model-pattern">View-Rulebook-Model Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#automatic-textual-and-binary-serialization-of-the-model">automatic textual and binary serialization of the model.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-tracing-and-textual-and-binary-serialization-for-the-tracing-o-f-the-controller">automatic tracing, and textual and binary serialization for the tracing o f the controller.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-testing-with-fuzzers-machine-learning-and-proofs">automatic testing with fuzzers, machine learning and proofs.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-bindings-to-execute-the-view-indipendently-from-rulebook">automatic bindings to execute the view indipendently from rulebook.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-bindings-to-write-the-view-in-multiple-languages">automatic bindings to write the view in multiple languages.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#view-multi-rulebook-controller-pattern">View-Multi Rulebook Controller pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multilayer-rulebook-controllers">Multilayer Rulebook Controllers.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4hammer.html">4Hammer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language-reference.html">Rulebook Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib/index.html">stdlib</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rulebook documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">UI, Controller and Gameplay</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ui_gameplay.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ui-controller-and-gameplay">
<h1>UI, Controller and Gameplay<a class="headerlink" href="#ui-controller-and-gameplay" title="Link to this heading"></a></h1>
<p>This page describes the inteded development cycle of a <a class="reference internal" href="#./the_inversion_of_control_problem.html#complex-interactive-subsystems"><span class="xref myst">complex interactive program</span></a>. It does so by showing where Rulebook code would fit into into a <a class="reference external" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">model view controller scheme</a> (MVC). Notice: Rulebook is not specific to a MVC scheme. We just use MVC because that is what many people are familliar with and we cannot describe how Rulebook would fit in every software architecture in existance.</p>
<section id="mvc">
<h2>MVC<a class="headerlink" href="#mvc" title="Link to this heading"></a></h2>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-b82542d7540dc8733b2aca4c351180498f85ee4d.png" alt="Figure made with TikZ" /></p>
</div><p>Different people assign to MVC components different meanings. We are going to provide a definition for them that we will use for the rest of this document.</p>
<section id="model">
<h3>Model<a class="headerlink" href="#model" title="Link to this heading"></a></h3>
<p>The model is the collection of data required to perform the business objective of the software. The model can be internal to the process or can be remote. It can be persistent or bound to the lifetime of the program only. It can be serializable or not.</p>
<p>Examples of models are:</p>
<ul class="simple">
<li><p>the content of a word document in microsoft word.</p></li>
<li><p>the in memory state of a video game, including the part that gets stored in a safe file, and the parts that are short lived but important for the rules of the game.</p></li>
</ul>
</section>
<section id="view">
<h3>View<a class="headerlink" href="#view" title="Link to this heading"></a></h3>
<p>The view is the component that knows how to display to the user (or to another program), the relevant parts of the model so that the user can execute decisions. The view responds to user actions (such as button presses) by issuing commands to the controller. The view get updated by the controller whenever the controller deems relevant to do so. This could be every frame like in videogames, or after every modification of the underlying model, such as in CRUD applications. Views are usually short lived and not stored on disk. Views can be local or remote.</p>
<p>Examples of views are:</p>
<ul class="simple">
<li><p>the entire graphical stack in a video game, which at each frame takes part or all of the state of the game (the model) and spits out a image rappresenting it.</p></li>
<li><p>a web-ui for some checkout procedure in a web shop, where the user provides data, click ok, and then is brought to a new screen until the purchage is compleated.</p></li>
</ul>
</section>
<section id="controller">
<h3>Controller<a class="headerlink" href="#controller" title="Link to this heading"></a></h3>
<p>The controller is the part of the program that knows the business logic of the program. It knows how to read at modify the model to carry out the program objective. Controllers are usually short lived and not stored on disk, except for some user configuration, for example the language of the user, or the dark/light theme preference of the user.
The controller can observe the model data to get notifications about when some of that data changes, so that additional logic can be triggered.</p>
<p>The controller knows how to update the view in response to changes in the model, and the controller knows how to reject invalid actions issues by the view.</p>
<p>Examples of controllers are:</p>
<ul class="simple">
<li><p>the section of the program in a meteo related tool that forecasts the weather, and when it is done doing so saves the prediction in the model, and shows it on screen.</p></li>
<li><p>the logic that drives the rules of chess indipendantly from the content of the screen.</p></li>
</ul>
</section>
</section>
<section id="view-rulebook-pattern">
<h2>VIEW-Rulebook pattern<a class="headerlink" href="#view-rulebook-pattern" title="Link to this heading"></a></h2>
<p>The simplest, but powerfull way of combining Rulebook with MVC is to subsume the Model and the Controller in RLC. Variables inside Rulebook action functions become the model, the action function itself becomes the controller.</p>
<p>The view sends actions to the action function, and since the action function knows all valid actions, it rejects those that are not. After each action, or series of batched actions, the view updates itself from scratch.</p>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-39d1724f2711465e26f5873d9d306a99d3583b59.png" alt="Figure made with TikZ" /></p>
</div><p>Altough slow since the view is recalculated entirelly, this pattern provides off-the-shelf.</p>
<ul class="simple">
<li><p>automatic textual and binary serialization of the model.</p></li>
<li><p>automatic tracing, and textual and binary serialization for the tracing o f the controller.</p></li>
<li><p>automatic testing with fuzzers, machine learning and proofs.</p></li>
<li><p>automatic bindings to execute the view indipendently from rulebook.</p></li>
<li><p>automatic bindings to write the view in multiple languages.</p></li>
</ul>
</section>
<section id="efficient-view-rulebook-pattern">
<h2>Efficient VIEW-Rulebook pattern<a class="headerlink" href="#efficient-view-rulebook-pattern" title="Link to this heading"></a></h2>
<p>This is the pattern implemented by our example <a class="reference internal" href="4hammer.html#software-architecture"><span class="std std-ref">4Hammer</span></a>.
As we said the VIEW-Rulebook pattern suffers because it updates the view at every user input, leading to bad performances in complex views.</p>
<p>We offer two ways of mending the problem. The first solution retains the entirety of the benefits of the VIEW-Rulebook pattern, and consists in emitting events to which the view can subscribe too and process at their own will.</p>
<p>For example, if you need a more performant implementation of chess for some reason, the Rulebook components can mantain along side the game a queue of events, such as “piece moved”, “piece removed”. After every action the view consumes these events and updates itself. So a graphical element showcasing a rook can simply subscribe to the “piece moved” event and update itself it the piece that was moved was indeed its own.</p>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-f4bb32c3c3e416fa3c65139ecf599594f71e2acc.png" alt="Figure made with TikZ" /></p>
</div><p>The second more performant implementation allows the Rulebook code to direclty call the code that updates the view, without any kind of indirection. That pattern breaks many of automatic tools offered by rulebook, but they can mostly be mended.</p>
<ul class="simple">
<li><p>automatic tracing, and textual and binary serialization for the tracing of the controller.</p></li>
</ul>
<p><strong>unchanged</strong></p>
<ul class="simple">
<li><p>automatic bindings to write the view in multiple languages.</p></li>
<li><p>automatic bindings to execute the view indipendently from rulebook.</p></li>
</ul>
<p><strong>meaningless</strong>, the code was designed to have no real separation between view and controller. If the tool requires multiple views, for example a web view and a integrated view, then the same techinques described for machine learning can be used.</p>
<ul class="simple">
<li><p>automatic testing with fuzzers, machine learning and proofs.</p></li>
</ul>
<p><strong>preserved with conditional compilation</strong>: The compiler can be configured to not emit the code specific to the view when building the Rulebook components for fuzzers, machine learning and proofs. If the machine learning tools are to be used on a released build with the engine enabled, it is possible to specify that view related memory objects, such as pointers to the view components to update after a model change, are to be ignored by the machine learning.</p>
<ul class="simple">
<li><p>automatic textual and binary serialization of the model.</p></li>
</ul>
<p><strong>requires to specify which are view datastructures</strong>: eventual view related datastructure inside the model can be marked as to be ignored during serialization and deserialization. After they are loaded from disk, the view must somehow repopulate them correctly.</p>
</section>
<section id="view-rulebook-model-pattern">
<h2>View-Rulebook-Model Pattern<a class="headerlink" href="#view-rulebook-model-pattern" title="Link to this heading"></a></h2>
<p>All discussion about the view expressed in the previous sections are still valid for this section, which instead focuses on the indipendent problem of mixing Rulebook with custom models.</p>
<p>The requirement for a custom model usually happen when you want partially or totally:</p>
<ul class="simple">
<li><p>reuse previously existing code to implement the model.</p></li>
<li><p>move the model into another process, for example because it is actually held in a remote database.</p></li>
<li><p>write the model in some other language because of performance or some other requirement (CUDA, SQL…).</p></li>
</ul>
<p>In this situations you can treat problem of connecting Rulebook to a external language, as explained [here][ToDo].</p>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-aa37087a2be001dc050b6768e1bce72b9244e169.png" alt="Figure made with TikZ" /></p>
</div><p>Just like when violating the separation of view and controller, writing parts of the model outside of rulebook makes it hard to use off-the-shelf rulebook tools.</p>
<section id="automatic-textual-and-binary-serialization-of-the-model">
<h3>automatic textual and binary serialization of the model.<a class="headerlink" href="#automatic-textual-and-binary-serialization-of-the-model" title="Link to this heading"></a></h3>
<p>Relies on having implemented the method to print, parse, binary print and binary parse the model. If you can provide those in the original language in every class that you use in Rulebook from another language, then you will get this functionality to work.</p>
</section>
<section id="automatic-tracing-and-textual-and-binary-serialization-for-the-tracing-o-f-the-controller">
<h3>automatic tracing, and textual and binary serialization for the tracing o f the controller.<a class="headerlink" href="#automatic-tracing-and-textual-and-binary-serialization-for-the-tracing-o-f-the-controller" title="Link to this heading"></a></h3>
<p>As long as you don’t use classes defined in some other language within action statments arguments, this will work. If you do use them there, then the same consideration for the previous point apply.</p>
</section>
<section id="automatic-testing-with-fuzzers-machine-learning-and-proofs">
<h3>automatic testing with fuzzers, machine learning and proofs.<a class="headerlink" href="#automatic-testing-with-fuzzers-machine-learning-and-proofs" title="Link to this heading"></a></h3>
<p>Fuzzers work as the previous point. On top of that:</p>
<ul class="simple">
<li><p>Model checking proofs require that model classes written in another are copiable.</p></li>
<li><p>Machine learning requires that your model classes written in another language implement the serialization to tensor traits.</p></li>
</ul>
</section>
<section id="automatic-bindings-to-execute-the-view-indipendently-from-rulebook">
<h3>automatic bindings to execute the view indipendently from rulebook.<a class="headerlink" href="#automatic-bindings-to-execute-the-view-indipendently-from-rulebook" title="Link to this heading"></a></h3>
<p>Unafected.</p>
</section>
<section id="automatic-bindings-to-write-the-view-in-multiple-languages">
<h3>automatic bindings to write the view in multiple languages.<a class="headerlink" href="#automatic-bindings-to-write-the-view-in-multiple-languages" title="Link to this heading"></a></h3>
<p>Unafected.</p>
</section>
</section>
<section id="view-multi-rulebook-controller-pattern">
<h2>View-Multi Rulebook Controller pattern<a class="headerlink" href="#view-multi-rulebook-controller-pattern" title="Link to this heading"></a></h2>
<p>While some programs may make sense to think in terms of a single gigantic interactive sequence from start to finish, this is usually not the case for most programs. Interactive programs usually have many small interactive sequences that the user can perform.
For example, a typical videogame may have a interactive sequence describing in which order powerups can be unlocked by a player, and another interactive sequence is the way a non player character behaves in respose to the player interacting with that character.
You could stick them all into a single enormous interactive sequence that allows to perform any action from any of al sub interactive sequences at the same time, or, instead you just consider them different controllers of different parts of the model.</p>
<p>In this situation, all considerations previously mentioned in this article still apply. The only difference is that many Rulebook controllers are placed inside a “controller aggregator” written in some other language (or even rulebook itself).</p>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-b182b33612176473f0b27aa0f5605eca91c3139a.png" alt="Figure made with TikZ" /></p>
</div><p>The shown controller describes a interactive game where one rulebook controller controls how the player can act in the world, one controller handles a complex non linear story progression, and a indipendant world controller handles non player characters.</p>
<p>Of course the astute reader will notice that this design describe a poor game where the player story is totally disconnected from the world controller, and this does not seem realistic. That brings us to the last MVC style design</p>
</section>
<section id="multilayer-rulebook-controllers">
<h2>Multilayer Rulebook Controllers.<a class="headerlink" href="#multilayer-rulebook-controllers" title="Link to this heading"></a></h2>
<p>Sometimes you have multiple interactive sequences that insist on the same model, and/or some those sequences may be allowed to create/cancel/modify another interactive sequence. For example, think of a video game where there is a interactive sequence which is the story, and another interactive sequence for each non player character on screen that handles the behaviour of that character. Say that when the user triggers a particular story event, all non player characters are to be destroyed, and the state of their interactive sequence, discarded.</p>
<p>You can achieve this by organizing your interactive sequences hierarchically. The following image displays a setup where there exists a single model (implemented in rulebook or not), shared between all controllers. The non player characters controller is the least important one, that drives the behaviour of characters when the player is near. Then there is the story controller which is allowed create, modify and destroy enemies, and therefore has access to the non player characters controller. Finally there is the player controller that handles the user inputs and depending on the player action can trigger a new event of the story.</p>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-60e1d6397ca0b007f021a7d0d111b52ad6ee9379.png" alt="Figure made with TikZ" /></p>
</div><p>While this pattern is more complex to write, it allows to create interactive sequences where sequences are allowed to modify each other, and it retains all the capabilities described in the <a class="reference internal" href="#view-rulebook-pattern"><span class="xref myst">View-Rulebook pattern</span></a>. As well as all considerations about dividing the controller from the model described earlier.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gym_tutorial.html" class="btn btn-neutral float-left" title="RLC and GYM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="4hammer.html" class="btn btn-neutral float-right" title="4Hammer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Massimo Fioravanti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>