

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Language Tour &mdash; Rulebook documentation 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e259d695"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interactive Inversion of control" href="the_inversion_of_control_problem.html" />
    <link rel="prev" title="Rulebook Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Rulebook documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Concepts:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Language Tour</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#action-functions">Action Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-main-loop-ownership">No-Main Loop Ownership</a></li>
<li class="toctree-l2"><a class="reference internal" href="#precondition-checkable">Precondition Checkable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#serializable">Serializable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inspectable">Inspectable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spin-function-implications">SPIN Function Implications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#action-statement-classes">Action Statement Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#composing-actions">Composing Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-cases">Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automatic-testing">Automatic Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-this-matters">Why This Matters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#finite-interactive-programs">Finite Interactive Programs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-exhaustive-state-testing">Example: Exhaustive State Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reinforcement-learning">Reinforcement Learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-catch-a-simple-rl-environment">Example: “Catch” — A Simple RL Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#self-configuring-uis">Self-Configuring UIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-ui-for-tic-tac-toe">Example: UI for Tic-Tac-Toe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compatibility">Compatibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-c-interop">Example: C# Interop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#remote-execution">Remote Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tooling">Tooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performance">Performance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="the_inversion_of_control_problem.html">Interactive Inversion of control</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_rationale.html">Graphic engines and machine learning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rlc.html">RLC</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building RLC from sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="interoperating.html">Interoperation with engines and languages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reinforcement Learning Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial for RL people</a></li>
<li class="toctree-l1"><a class="reference internal" href="gym_tutorial.html">RLC and GYM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UIs, Controllers, Gameplay:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ui_gameplay.html">UI, Controller, and Gameplay</a></li>
<li class="toctree-l1"><a class="reference internal" href="4hammer.html">4Hammer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language-reference.html">Rulebook Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib/index.html">stdlib</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rulebook documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Language Tour</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/language_tour.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="language-tour">
<h1>Language Tour<a class="headerlink" href="#language-tour" title="Link to this heading"></a></h1>
<p>Rulebook is a compiled and statically checked language.</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="c1"># rlc hellow world</span>
<span class="kn">import</span> <span class="n">serialization</span><span class="p">.</span><span class="n">print</span>

<span class="kn">cls</span> <span class="nc">SimpleRegularCode</span><span class="p">:</span>
    <span class="nc">Int</span> <span class="n">x</span>
    <span class="nc">Bool</span> <span class="n">y</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">pair</span> <span class="p">:</span> <span class="nc">SimpleRegularCode</span>
    <span class="n">print</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="c1"># {x: 0, y: false}</span>
    <span class="kr">return</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Its defining innovation is the concept of <strong>action functions</strong>—a mechanism designed to handle complex interactions—enhanced with <strong>SPIN</strong> properties. Rulebook carefully combines multiple uncommon languages features in a imperative language that is more than the sum of the parts.</p>
<section id="action-functions">
<h2>Action Functions<a class="headerlink" href="#action-functions" title="Link to this heading"></a></h2>
<p>Rulebook is built to simplify the construction of <a class="reference internal" href="the_inversion_of_control_problem.html#complex-interactive-subsystems"><span class="std std-ref">complex interactive subsystems</span></a>. It achieves this through <strong>SPIN functions</strong>, which encapsulate stateful, inspectable logic without taking over control flow.</p>
<p><strong>SPIN</strong> stands for:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#serializable"><span class="xref myst">Serializable</span></a></p></li>
<li><p><a class="reference internal" href="#precondition-checkable"><span class="xref myst">Precondition checkable</span></a></p></li>
<li><p><a class="reference internal" href="#inspectable"><span class="xref myst">Inspectable</span></a></p></li>
<li><p><a class="reference internal" href="#no-main-loop-ownership"><span class="xref myst">No-main loop owning</span></a></p></li>
</ul>
<p>These properties allow developers to <a class="reference internal" href="#spin-function-implications"><span class="xref myst">store, load, print, replay, and modify</span></a> both program state and execution traces in a principled and testable way.</p>
</section>
<hr class="docutils" />
<section id="no-main-loop-ownership">
<h2>No-Main Loop Ownership<a class="headerlink" href="#no-main-loop-ownership" title="Link to this heading"></a></h2>
<p>In interactive systems, programs must often wait for input from users or networks. Typically, such systems are governed by a <strong>framework</strong> that controls the main loop—such as a GUI or game engine—rendering frames while awaiting events.</p>
<p>Rulebook’s <strong>action functions</strong> are coroutines. They don’t need to control the main loop, making them inherently framework-agnostic.</p>
<p>Here’s an example. The <code class="docutils literal notranslate"><span class="pre">say_hello()</span></code> function runs until it hits an <code class="docutils literal notranslate"><span class="pre">act</span> <span class="pre">resume()</span></code> statement. From the main function, we resume execution using <code class="docutils literal notranslate"><span class="pre">sayer.resume()</span></code>, causing the next part of the coroutine to run:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">serialization</span><span class="p">.</span><span class="n">print</span>

<span class="kn">act</span> <span class="n">say_hello</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">HelloSayer</span><span class="p">:</span>
    <span class="kn">act</span> <span class="n">resume</span><span class="p">()</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
    <span class="kn">act</span> <span class="n">resume</span><span class="p">()</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">sayer</span> <span class="o">=</span> <span class="n">say_hello</span><span class="p">()</span>
    <span class="n">sayer</span><span class="p">.</span><span class="n">resume</span><span class="p">()</span> <span class="c1"># hello</span>
    <span class="n">sayer</span><span class="p">.</span><span class="n">resume</span><span class="p">()</span> <span class="c1"># hello</span>
    <span class="kr">return</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Thanks to this <strong>no-main loop ownership</strong>, you can write <strong>interactive programs</strong> as if they directly prompt the <strong>user</strong>, without needing to integrate deeply with or understand the details of the underlying <strong>framework</strong>.</p>
</section>
<section id="precondition-checkable">
<h2>Precondition Checkable<a class="headerlink" href="#precondition-checkable" title="Link to this heading"></a></h2>
<p><strong>Precondition checkability</strong> means the framework that owns the main loop can proactively validate user inputs—without embedding logic directly into the action function.</p>
<p>Consider this installer example: it prompts the user for a valid installation path, asks whether to include experimental content, and performs the installation based on that input.</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">string</span>

<span class="kn">act</span> <span class="n">installer</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Installer</span><span class="p">:</span>
    <span class="n">show_path_screen_prompt</span><span class="p">()</span>
    <span class="kn">act</span> <span class="n">select_location</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">String</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span> <span class="o">!</span><span class="n">file_exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">show_experimental_content_prompt</span><span class="p">()</span>
    <span class="kn">act</span> <span class="n">install_experimental_content</span><span class="p">(</span><span class="nc">Bool</span> <span class="n">do_it</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">do_it</span><span class="p">:</span>
        <span class="n">install_with_extra</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="kr">else</span><span class="p">:</span>
        <span class="n">install</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">installer</span> <span class="o">=</span> <span class="n">installer</span><span class="p">()</span>
    <span class="kr">let</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;wrong_path&quot;</span><span class="n">s</span>
    <span class="kr">if</span> <span class="n">can</span> <span class="n">installer</span><span class="p">.</span><span class="n">select_location</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">installer</span><span class="p">.</span><span class="n">select_location</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">installer</span><span class="p">.</span><span class="n">install_experimental_content</span><span class="p">(</span><span class="nc">False</span><span class="p">)</span>
    <span class="kr">return</span> <span class="mi">0</span>
</pre></div>
</div>
<p>In Rulebook, <strong>suspension points</strong> inside action functions are called <strong>action statements</strong>. These can take arguments and may include a <strong>boolean condition</strong> that defines when the action is valid. By using the <code class="docutils literal notranslate"><span class="pre">can</span></code> operator, the framework can check whether a given user input is valid <strong>before</strong> applying it—without complicating the action function with manual validation logic.</p>
</section>
<hr class="docutils" />
<section id="serializable">
<h2>Serializable<a class="headerlink" href="#serializable" title="Link to this heading"></a></h2>
<p>In many interactive systems, it’s useful—or even necessary—to <strong>save and restore program state</strong>. Rulebook supports this by allowing coroutines to be <strong>serialized and copied</strong>.</p>
<p>Let’s say you wrote a simple rock-paper-scissors game. After player 1 selects a move, you want to test every possible response from player 2 to find a winning one.</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">enum</span> <span class="nc">Gesture</span><span class="p">:</span>
    <span class="n">rock</span>
    <span class="n">paper</span>
    <span class="n">scizor</span>

<span class="kn">act</span> <span class="n">play</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="kn">act</span> <span class="n">select</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Gesture</span> <span class="n">player1</span><span class="p">)</span>
    <span class="kn">act</span> <span class="n">select</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Gesture</span> <span class="n">player2</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">player2_wins</span><span class="p">(</span><span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">):</span>
        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;you win&quot;</span><span class="p">)</span>
    <span class="kr">else</span><span class="p">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;you lose&quot;</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">state</span> <span class="o">=</span> <span class="n">play</span><span class="p">()</span>
    <span class="n">state</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="nc">Gesture</span><span class="p">::</span><span class="n">rock</span><span class="p">)</span>

    <span class="kr">let</span> <span class="n">copy</span> <span class="o">=</span> <span class="n">state</span>
    <span class="n">copy</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="nc">Gesture</span><span class="p">::</span><span class="n">rock</span><span class="p">)</span>   <span class="c1"># you lose</span>

    <span class="n">copy</span> <span class="o">=</span> <span class="n">state</span>
    <span class="n">copy</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="nc">Gesture</span><span class="p">::</span><span class="n">scizor</span><span class="p">)</span> <span class="c1"># you lose</span>

    <span class="n">copy</span> <span class="o">=</span> <span class="n">state</span>
    <span class="n">copy</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="nc">Gesture</span><span class="p">::</span><span class="n">paper</span><span class="p">)</span>  <span class="c1"># you win</span>
</pre></div>
</div>
<p>Because Rulebook supports serialization, you can <strong>copy coroutine states</strong>, explore different branches, and test all valid user interactions from any point. This makes techniques like automated testing, state-space exploration, and replay debugging straightforward and effective.</p>
</section>
<hr class="docutils" />
<section id="inspectable">
<h2>Inspectable<a class="headerlink" href="#inspectable" title="Link to this heading"></a></h2>
<p>Sometimes the framework needs access to internal coroutine state—such as a variable a user selected earlier—in order to render UI elements, track progress, or drive decision-making.</p>
<p>Revisiting the rock-paper-scissors example, suppose you want to read which move player 1 selected without executing the full game logic:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">enum</span> <span class="nc">Gesture</span><span class="p">:</span>
    <span class="n">rock</span>
    <span class="n">paper</span>
    <span class="n">scizor</span>

<span class="kn">act</span> <span class="n">play</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="kn">act</span> <span class="n">select</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Gesture</span> <span class="n">player1</span><span class="p">)</span>
    <span class="kn">act</span> <span class="n">select</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Gesture</span> <span class="n">player2</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">player2_wins</span><span class="p">(</span><span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">):</span>
        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;you win&quot;</span><span class="p">)</span>
    <span class="kr">else</span><span class="p">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;you lose&quot;</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">state</span> <span class="o">=</span> <span class="n">play</span><span class="p">()</span>
    <span class="n">state</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="nc">Gesture</span><span class="p">::</span><span class="n">rock</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">player1</span><span class="p">)</span> <span class="c1"># rock</span>
</pre></div>
</div>
<p>In Rulebook, any variable marked with the <code class="docutils literal notranslate"><span class="pre">frm</span></code> keyword is <strong>automatically accessible</strong> from outside the coroutine. This allows you to treat action functions as lightweight <strong>stateful objects</strong>—like classes. If a concept is naturally <strong>procedural</strong>, you can model it as a coroutine. If it’s naturally <strong>structural</strong>, you can define it as a class. Rulebook supports both approaches seamlessly.</p>
</section>
<section id="spin-function-implications">
<h2>SPIN Function Implications<a class="headerlink" href="#spin-function-implications" title="Link to this heading"></a></h2>
<p>When used in an interpreted language or in combination with Rulebook’s <a class="reference internal" href="#action-statements-classes"><span class="xref myst">action statement classes</span></a>, <strong>SPIN functions</strong> unlock advanced techniques for managing <strong>complex interactive systems</strong>.</p>
<p>In addition to cleanly separating <strong>UI framework concerns</strong> from <strong>application logic</strong>, SPIN functions allow you to <strong>store</strong>, <strong>load</strong>, <strong>print</strong>, <strong>replay</strong>, and <strong>modify</strong> both the program’s state and its execution trace.</p>
<p>Here’s an example: this interactive program selects random actions, applies them to a state, stores the resulting actions in a trace, and later replays that trace on a new instance of the program.</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="n">classes</span>
<span class="kn">act</span> <span class="n">installer</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Installer</span><span class="p">:</span>
    <span class="n">show_path_screen_prompt</span><span class="p">()</span>
    <span class="kn">act</span> <span class="n">select_location</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">String</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span> <span class="o">!</span><span class="n">file_exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">show_experimental_content_prompt</span><span class="p">()</span>
    <span class="kn">act</span> <span class="n">install_experimental_content</span><span class="p">(</span><span class="nc">Bool</span> <span class="n">do_it</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">do_it</span><span class="p">:</span>
        <span class="n">install_with_extra</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="kr">else</span><span class="p">:</span>
        <span class="n">install</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">trace</span> <span class="p">:</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">AnyInstallerAction</span><span class="o">&gt;</span>
    <span class="kr">let</span> <span class="n">state</span> <span class="o">=</span> <span class="n">installer</span><span class="p">()</span>
    <span class="kr">while</span> <span class="o">!</span><span class="n">state</span><span class="p">.</span><span class="n">is_done</span><span class="p">():</span>
        <span class="kr">let</span> <span class="n">action</span> <span class="o">=</span> <span class="n">select_random_valid_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">apply</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="n">trace</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">installer</span><span class="p">()</span>
    <span class="kr">for</span> <span class="n">action</span> <span class="kr">in</span> <span class="n">trace</span><span class="p">:</span>
        <span class="n">apply</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

    <span class="kr">return</span> <span class="mi">0</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">select_random_valid_action</span></code> chooses valid actions, the trace might look like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{ InstallerSelectLocation{ path: &quot;some_valid_path&quot; }, InstallerInstallExperimentalContent{ do_it: true } }
</pre></div>
</div>
<p>This technique is fundamental for:</p>
<ul class="simple">
<li><p><strong>Fuzz testing</strong></p></li>
<li><p><strong>Reinforcement learning</strong></p></li>
<li><p><strong>Behavioral verification</strong></p></li>
</ul>
<p>By recording and replaying action sequences, you can rigorously test application logic <strong>independently</strong> of the surrounding infrastructure.</p>
</section>
<hr class="docutils" />
<section id="action-statement-classes">
<h2>Action Statement Classes<a class="headerlink" href="#action-statement-classes" title="Link to this heading"></a></h2>
<p>In interactive systems, you may want to <strong>delay</strong> the execution of an action—such as processing a user click after a few frames. Rulebook makes this possible using the <code class="docutils literal notranslate"><span class="pre">&#64;classes</span></code> attribute on action functions.</p>
<p>Here’s an example. A rendering loop polls GUI events, converts them into actions, queues them, and applies them with a delay:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="n">classes</span>
<span class="kn">act</span> <span class="n">installer</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Installer</span><span class="p">:</span>
    <span class="n">show_path_screen_prompt</span><span class="p">()</span>
    <span class="kn">act</span> <span class="n">select_location</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">String</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span> <span class="o">!</span><span class="n">file_exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">show_experimental_content_prompt</span><span class="p">()</span>
    <span class="kn">act</span> <span class="n">install_experimental_content</span><span class="p">(</span><span class="nc">Bool</span> <span class="n">do_it</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">do_it</span><span class="p">:</span>
        <span class="n">install_with_extra</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="kr">else</span><span class="p">:</span>
        <span class="n">install</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">state</span> <span class="p">:</span> <span class="n">installer</span><span class="p">()</span>
    <span class="kr">let</span> <span class="n">delayed_events</span> <span class="p">:</span> <span class="nc">DelayedEventQueue</span>
    <span class="kr">let</span> <span class="n">ui</span> <span class="p">:</span> <span class="nc">GUI</span>
    <span class="kr">while</span> <span class="l">true</span><span class="p">:</span>
        <span class="n">render_frame</span><span class="p">()</span>
        <span class="kr">let</span> <span class="n">events</span> <span class="o">=</span> <span class="n">poll_user_events</span><span class="p">()</span>

        <span class="c1"># Queue an event to be processed later</span>
        <span class="kr">if</span> <span class="n">event</span><span class="p">.</span><span class="n">clicked_some_button</span><span class="p">:</span>
            <span class="kr">let</span> <span class="n">action</span> <span class="p">:</span> <span class="nc">InstallerSelectLocation</span>
            <span class="n">action</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">path_field</span><span class="p">.</span><span class="n">text</span>
            <span class="n">delayed_events</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">event</span><span class="p">.</span><span class="n">clicked_on_checkbox</span><span class="p">:</span>
            <span class="kr">let</span> <span class="n">action</span> <span class="p">:</span> <span class="nc">InstallerInstallExperimentalContent</span>
            <span class="n">action</span><span class="p">.</span><span class="n">do_it</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">checkbox</span><span class="p">.</span><span class="n">is_set</span>
            <span class="n">delayed_events</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c1"># Apply events after a delay</span>
        <span class="kr">for</span> <span class="n">event</span> <span class="kr">in</span> <span class="n">delayed_events</span><span class="p">.</span><span class="n">get_events_to_apply</span><span class="p">():</span>
            <span class="kr">if</span> <span class="n">can</span> <span class="n">apply</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
                <span class="n">apply</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
<p>When you annotate an action function with <code class="docutils literal notranslate"><span class="pre">&#64;classes</span></code>, Rulebook generates a <strong>class</strong> for each action statement. These classes only contain the relevant arguments. Additionally, a <strong>type-safe union</strong>—<code class="docutils literal notranslate"><span class="pre">AnyInstallerAction</span></code>—is created to represent all possible actions.</p>
<p>In the example above, the generated classes would look like:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">cls</span> <span class="nc">InstallerSelectLocation</span><span class="p">:</span>
    <span class="nc">String</span> <span class="n">location</span>

<span class="kn">cls</span> <span class="nc">InstallerInstallExperimentalContent</span><span class="p">:</span>
    <span class="nc">Bool</span> <span class="n">do_it</span>

<span class="kr">using</span> <span class="nc">AnyInstallerAction</span> <span class="o">=</span> <span class="nc">InstallerSelectLocation</span> <span class="p">|</span> <span class="nc">InstallerInstallExperimentalContent</span>
</pre></div>
</div>
<p>These classes can be <strong>stored</strong>, <strong>serialized</strong>, <strong>printed</strong>, <strong>copied</strong>, and—most importantly—<strong>applied</strong> using the built-in <code class="docutils literal notranslate"><span class="pre">apply</span></code> function.</p>
<p>By treating actions as first-class values, Rulebook allows you to <strong>schedule and manage user interactions</strong> without coupling your application logic to the GUI framework—encouraging cleaner, more modular architectures.</p>
</section>
<section id="composing-actions">
<h2>Composing Actions<a class="headerlink" href="#composing-actions" title="Link to this heading"></a></h2>
<p><strong>Complex interactive subsystems</strong>—the kind Rulebook is built to handle—often benefit from being broken down into <strong>smaller, reusable parts</strong>.</p>
<p>Rulebook enables this with a mechanism for composing action functions. Here’s an example of how to structure a compound interaction like rolling two dice, with the added ability to reroll based on the outcome:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">act</span> <span class="n">roll_2_dice</span><span class="p">(</span><span class="nc">Int</span> <span class="n">num_faces</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">RollDice</span><span class="p">:</span>
    <span class="kn">act</span> <span class="n">roll</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Int</span> <span class="n">first</span><span class="p">)</span> <span class="p">{</span><span class="n">first</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first</span> <span class="o">&lt;=</span> <span class="n">num_faces</span><span class="p">}</span>
    <span class="kn">act</span> <span class="n">roll</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Int</span> <span class="n">second</span><span class="p">)</span> <span class="p">{</span><span class="n">second</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">second</span> <span class="o">&lt;=</span> <span class="n">num_faces</span><span class="p">}</span>

<span class="kn">act</span> <span class="n">rerollable_roll</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">RerollableDices</span><span class="p">:</span>
    <span class="kn">subaction</span><span class="o">*</span> <span class="n">roll</span> <span class="o">=</span> <span class="n">roll_2_dice</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">roll</span><span class="p">.</span><span class="n">first</span> <span class="o">+</span> <span class="n">roll</span><span class="p">.</span><span class="n">second</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">roll_2_dice</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="kn">subaction</span><span class="o">*</span> <span class="n">roll</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">sequence</span> <span class="o">=</span> <span class="n">rerollable_roll</span><span class="p">()</span>
    <span class="n">sequence</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sequence</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sequence</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">sequence</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="n">sequence</span><span class="p">.</span><span class="n">roll</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>  <span class="c1"># 3</span>
    <span class="n">print</span><span class="p">(</span><span class="n">sequence</span><span class="p">.</span><span class="n">roll</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="c1"># 4</span>
</pre></div>
</div>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">subaction*</span></code> exposes the inner action function’s interface to the outside world—<strong>until it completes</strong>. This lets you structure your logic as <strong>nested interactive sequences</strong>, where each subsequence can be reused, composed, and tested in isolation.</p>
<p>Read more about <code class="docutils literal notranslate"><span class="pre">subaction*</span></code> <a class="reference internal" href="language-reference.html#subaction-statements"><span class="std std-ref">here</span></a>.</p>
</section>
<hr class="docutils" />
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading"></a></h2>
<p>Now that we’ve explored how <a class="reference internal" href="#action-functions"><span class="xref myst">action functions</span></a> work, let’s look at real-world applications.</p>
</section>
<hr class="docutils" />
<section id="automatic-testing">
<h2>Automatic Testing<a class="headerlink" href="#automatic-testing" title="Link to this heading"></a></h2>
<p>Rulebook (RLC) includes a built-in <strong>fuzzer</strong> that can generate and apply random actions to your interactive programs—out of the box or customized for your needs.</p>
<blockquote>
<div><p>Curious about fuzzing? <a class="reference external" href="https://en.wikipedia.org/wiki/Fuzzing">Here’s a brief intro.</a></p>
</div></blockquote>
<p>Below is a simple example: an interactive sequence that collects user data. However, there’s a bug—the program doesn’t guard against invalid age values (e.g. zero or negative numbers):</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">action</span>

<span class="p">@</span><span class="n">classes</span>
<span class="kn">act</span> <span class="n">ask_user_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">AskUserData</span><span class="p">:</span>
    <span class="kn">act</span> <span class="n">insert_nationality</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Int</span> <span class="n">nationality_id</span><span class="p">)</span>
    <span class="kn">act</span> <span class="n">insert_age</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Int</span> <span class="n">age</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="kr">return</span>  <span class="c1"># nothing else to do</span>

    <span class="kn">act</span> <span class="n">insert_parent_nationality</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Int</span> <span class="n">parent_nation_id</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">assert</span><span class="p">(</span><span class="l">false</span><span class="p">,</span> <span class="s2">&quot;age cannot be negative&quot;</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">fuzz</span><span class="p">(</span><span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">Byte</span><span class="o">&gt;</span> <span class="n">input</span><span class="p">):</span>
    <span class="kr">if</span> <span class="n">input</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="kr">return</span>
    <span class="kr">let</span> <span class="n">state</span> <span class="o">=</span> <span class="n">ask_user_data</span><span class="p">()</span>
    <span class="kr">let</span> <span class="n">action</span> <span class="p">:</span> <span class="nc">AnyAskUserDataAction</span>
    <span class="kr">let</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">parse_actions</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">action</span> <span class="kr">in</span> <span class="n">trace</span><span class="p">:</span>
        <span class="kr">if</span> <span class="n">can</span> <span class="n">apply</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
            <span class="n">apply</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="n">print</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre></div>
</div>
<p>You can compile and run this test like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On Linux</span>
rlc<span class="w"> </span>file.rl<span class="w"> </span>-o<span class="w"> </span>executable<span class="w"> </span>--fuzzer
./executable<span class="w">                </span><span class="c1"># Automatically crashes if invalid input is found</span>
./executable<span class="w"> </span>crashing_trace.txt
<span class="c1"># Output:</span>
<span class="c1"># ./file.rl:12:9 error: age cannot be negative</span>
</pre></div>
</div>
<p>With minimal effort, you’ve created a <strong>property-based test</strong> that finds bugs by driving your interactive sequence with random—but valid—input.</p>
<p>In this case, the fix is simple: update the action statement with a guard condition:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">act</span> <span class="n">insert_age</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<section id="why-this-matters">
<h3>Why This Matters<a class="headerlink" href="#why-this-matters" title="Link to this heading"></a></h3>
<p>Fuzzing is useful not only for <strong>ensuring robustness</strong>, but also for <strong>rapid prototyping</strong>. If you’re iterating quickly on an interactive flow you might throw away tomorrow, don’t spend time writing manual tests—just run the fuzzer and confirm it doesn’t crash.</p>
<p>That said, most of a fuzzer’s time is spent generating and discarding invalid inputs. In production, you’ll often filter actions using <code class="docutils literal notranslate"><span class="pre">can</span> <span class="pre">apply</span></code>, so testing those rejections isn’t always necessary.</p>
<p>If your system allows for fully <strong>enumerating all valid actions</strong>—see <a class="reference internal" href="#finite-interactive-programs"><span class="xref myst">Finite Interactive Programs</span></a>—you can write fuzzers that are far more efficient and targeted.</p>
<p>And depending on the design of your application, additional optimizations may be possible.</p>
</section>
</section>
<section id="finite-interactive-programs">
<h2>Finite Interactive Programs<a class="headerlink" href="#finite-interactive-programs" title="Link to this heading"></a></h2>
<p><strong>Finite interactive programs</strong> are systems in which the user can take only a <strong>limited number of distinct actions</strong>, even if the total number of possible combinations is large.</p>
<section id="examples">
<h3>Examples:<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Chess</strong>: While games can, in theory, go on indefinitely, at any given moment each player can only choose from a finite number of moves (limited by the number of pieces and legal board positions).</p></li>
<li><p><strong>Mechanical vending machine</strong>: The user can insert a fixed set of coins and choose from a predefined set of products.</p></li>
</ul>
<p>Because of their finiteness, these systems are excellent candidates for classic algorithms such as <a class="reference external" href="https://en.wikipedia.org/wiki/State_space_search">state space search</a>.</p>
</section>
<section id="example-exhaustive-state-testing">
<h3>Example: Exhaustive State Testing<a class="headerlink" href="#example-exhaustive-state-testing" title="Link to this heading"></a></h3>
<p>Here’s a Rulebook example that explores all valid states of a simple tic-tac-toe game using <code class="docutils literal notranslate"><span class="pre">enumerate</span></code>, and verifies that the program never crashes, regardless of the user’s input.</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="n">classes</span>
<span class="kn">act</span> <span class="n">play</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="kn">frm</span> <span class="n">board</span> <span class="p">:</span> <span class="nc">Board</span>
    <span class="kr">while</span> <span class="o">!</span><span class="n">board</span><span class="p">.</span><span class="n">full</span><span class="p">():</span>
        <span class="kn">act</span> <span class="n">mark</span><span class="p">(</span><span class="nc">BInt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">,</span> <span class="nc">BInt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">board</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="n">board</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">current_player</span><span class="p">())</span>

        <span class="kr">if</span> <span class="n">board</span><span class="p">.</span><span class="n">three_in_a_line_player</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">current_player</span><span class="p">()):</span>
            <span class="kr">return</span>
        <span class="n">board</span><span class="p">.</span><span class="n">next_turn</span><span class="p">()</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">frontier</span> <span class="p">:</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">Game</span><span class="o">&gt;</span>
    <span class="kr">let</span> <span class="n">any_action</span> <span class="p">:</span> <span class="nc">AnyGameAction</span>
    <span class="kr">let</span> <span class="kn">actions</span> <span class="o">=</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">any_action</span><span class="p">)</span> <span class="c1"># contains 9 elements</span>
    <span class="n">frontier</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">play</span><span class="p">())</span>
    <span class="kr">while</span> <span class="o">!</span><span class="n">frontier</span><span class="p">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="kr">let</span> <span class="n">state</span> <span class="o">=</span> <span class="n">frontier</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="kr">for</span> <span class="n">action</span> <span class="kr">in</span> <span class="kn">actions</span><span class="p">:</span>
            <span class="kr">if</span> <span class="n">can</span> <span class="n">apply</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
                <span class="n">frontier</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="n">apply</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">frontier</span><span class="p">.</span><span class="n">back</span><span class="p">())</span>

    <span class="kr">return</span> <span class="mi">0</span>
</pre></div>
</div>
<p>The core idea here is the use of <code class="docutils literal notranslate"><span class="pre">BInt&lt;0,</span> <span class="pre">3&gt;</span></code>, which restricts inputs to integers between 0 and 2 (inclusive of 0, exclusive of 3). This constraint ensures that all <code class="docutils literal notranslate"><span class="pre">mark</span></code> actions are within valid board coordinates. In fact, this program <strong>formally guarantees</strong> that <code class="docutils literal notranslate"><span class="pre">play()</span></code> will never crash under any valid sequence of moves.</p>
<p>While this technique doesn’t scale to large programs due to the exponential growth of possible states, Rulebook’s <strong>composable architecture</strong> allows you to isolate and test individual interactive sequences—even if the entire system can’t be exhaustively verified.</p>
</section>
</section>
<hr class="docutils" />
<section id="reinforcement-learning">
<h2>Reinforcement Learning<a class="headerlink" href="#reinforcement-learning" title="Link to this heading"></a></h2>
<p>If you install Rulebook via the Python package <code class="docutils literal notranslate"><span class="pre">rl_language</span></code>, you gain access to built-in support for <a class="reference external" href="https://en.wikipedia.org/wiki/Reinforcement_learning">reinforcement learning</a>.</p>
<p>Previously, we saw how to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#finite-interactive-programs"><span class="xref myst">Prove</span></a> that certain components never crash</p></li>
<li><p><a class="reference internal" href="#automatic-testing"><span class="xref myst">Fuzz</span></a> larger programs to uncover failures</p></li>
</ul>
<p>However, these methods focus on <strong>correctness</strong>—determining whether a program crashes or not. What if you’re interested in <strong>performance</strong>, or how a particular metric evolves over time?</p>
<p>This is where <strong>reinforcement learning</strong> shines.</p>
<hr class="docutils" />
<section id="example-catch-a-simple-rl-environment">
<h3>Example: “Catch” — A Simple RL Environment<a class="headerlink" href="#example-catch-a-simple-rl-environment" title="Link to this heading"></a></h3>
<p>The following program implements <strong>Catch</strong>, a classic test environment in reinforcement learning. In this game, the player moves left or right to catch a falling ball. The score is 1 if the ball is caught; 0 otherwise.</p>
<p>The program is more detailed than previous examples because it includes:</p>
<ul class="simple">
<li><p>Number of players</p></li>
<li><p>Current player logic</p></li>
<li><p>Game state and scoring metrics</p></li>
</ul>
<p>If the implementation is correct, a trained agent should eventually achieve a near-perfect average score.</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">serialization</span><span class="p">.</span><span class="n">print</span>
<span class="kn">import</span> <span class="n">range</span>
<span class="kn">import</span> <span class="n">collections</span><span class="p">.</span><span class="n">vector</span>
<span class="kn">import</span> <span class="n">machine_learning</span>
<span class="kn">import</span> <span class="n">action</span>

<span class="c1"># Constants for the game</span>
<span class="kr">const</span> <span class="n">NUM_ROWS</span> <span class="o">=</span> <span class="mi">11</span>
<span class="kr">const</span> <span class="n">NUM_COLUMS</span> <span class="o">=</span> <span class="mi">5</span>

<span class="kn">enum</span> <span class="nc">Direction</span><span class="p">:</span>
    <span class="nc">Left</span>
    <span class="nc">None</span>
    <span class="nc">Right</span>

    <span class="kn">fun</span> <span class="n">equal</span><span class="p">(</span><span class="nc">Direction</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Bool</span><span class="p">:</span>
        <span class="kr">return</span> <span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">value</span>

    <span class="kn">fun</span> <span class="n">not_equal</span><span class="p">(</span><span class="nc">Direction</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Bool</span><span class="p">:</span>
        <span class="kr">return</span> <span class="o">!</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>


<span class="kr">using</span> <span class="nc">Column</span> <span class="o">=</span> <span class="nc">BInt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_COLUMS</span><span class="o">&gt;</span>
<span class="kr">using</span> <span class="nc">Row</span> <span class="o">=</span> <span class="nc">BInt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_ROWS</span><span class="o">&gt;</span>

<span class="c1"># The main Catch game</span>
<span class="p">@</span><span class="n">classes</span>
<span class="kn">act</span> <span class="n">play</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="kn">frm</span> <span class="n">ball_row</span> <span class="p">:</span> <span class="nc">Row</span>
    <span class="kn">frm</span> <span class="n">ball_col</span> <span class="p">:</span> <span class="nc">Column</span>
    <span class="kn">frm</span> <span class="n">paddle_col</span> <span class="p">:</span> <span class="nc">Column</span>

    <span class="c1"># Initialization - chance player selects starting ball column</span>
    <span class="kn">act</span> <span class="n">set_start_location</span><span class="p">(</span><span class="nc">Column</span> <span class="n">col</span><span class="p">)</span>
    <span class="n">ball_col</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">col</span><span class="p">.</span><span class="n">value</span>
    <span class="n">paddle_col</span> <span class="o">=</span> <span class="n">NUM_COLUMS</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Game loop - player makes moves until ball reaches bottom</span>
    <span class="kr">while</span> <span class="n">ball_row</span> <span class="o">!=</span> <span class="n">NUM_ROWS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="kn">act</span> <span class="n">move</span><span class="p">(</span><span class="nc">Direction</span> <span class="n">direction</span><span class="p">)</span>

        <span class="n">ball_row</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ball_row</span><span class="p">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="kr">let</span> <span class="n">actual_direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Convert to -1, 0, 1</span>
        <span class="n">paddle_col</span> <span class="o">=</span> <span class="n">paddle_col</span><span class="p">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">actual_direction</span>

<span class="c1"># Cell states</span>
<span class="kn">enum</span> <span class="nc">CellState</span><span class="p">:</span>
    <span class="nc">Empty</span>
    <span class="nc">Paddle</span>
    <span class="nc">Ball</span>

    <span class="kn">fun</span> <span class="n">equal</span><span class="p">(</span><span class="nc">CellState</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Bool</span><span class="p">:</span>
        <span class="kr">return</span> <span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">value</span>

    <span class="kn">fun</span> <span class="n">not_equal</span><span class="p">(</span><span class="nc">CellState</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Bool</span><span class="p">:</span>
        <span class="kr">return</span> <span class="o">!</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># Get cell state at specific row and column</span>
<span class="kn">fun</span> <span class="n">cell_at</span><span class="p">(</span><span class="nc">Game</span> <span class="n">game</span><span class="p">,</span> <span class="nc">Int</span> <span class="n">row</span><span class="p">,</span> <span class="nc">Int</span> <span class="n">col</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">CellState</span><span class="p">:</span>
    <span class="kr">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">NUM_ROWS</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">and</span> <span class="n">col</span> <span class="o">==</span> <span class="n">game</span><span class="p">.</span><span class="n">paddle_col</span><span class="p">.</span><span class="n">value</span><span class="p">:</span>
        <span class="kr">return</span> <span class="nc">CellState</span><span class="p">::</span><span class="nc">Paddle</span>
    <span class="kr">else</span> <span class="kr">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">game</span><span class="p">.</span><span class="n">ball_row</span><span class="p">.</span><span class="n">value</span> <span class="o">and</span> <span class="n">col</span> <span class="o">==</span> <span class="n">game</span><span class="p">.</span><span class="n">ball_col</span><span class="p">.</span><span class="n">value</span><span class="p">:</span>
        <span class="kr">return</span> <span class="nc">CellState</span><span class="p">::</span><span class="nc">Ball</span>
    <span class="kr">return</span> <span class="nc">CellState</span><span class="p">::</span><span class="nc">Empty</span>



<span class="c1"># Function for machine learning components to display the game state</span>
<span class="kn">fun</span> <span class="n">pretty_print</span><span class="p">(</span><span class="nc">Game</span> <span class="n">game</span><span class="p">):</span>
    <span class="c1"># Generate string representation of the board</span>
    <span class="kr">let</span> <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="n">s</span>
    <span class="kr">for</span> <span class="n">row</span> <span class="kr">in</span> <span class="n">range</span><span class="p">(</span><span class="n">NUM_ROWS</span><span class="p">):</span>
        <span class="kr">for</span> <span class="n">col</span> <span class="kr">in</span> <span class="n">range</span><span class="p">(</span><span class="n">NUM_COLUMS</span><span class="p">):</span>
            <span class="kr">if</span> <span class="n">cell_at</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="nc">CellState</span><span class="p">::</span><span class="nc">Empty</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="n">s</span>
            <span class="kr">else</span> <span class="kr">if</span> <span class="n">cell_at</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="nc">CellState</span><span class="p">::</span><span class="nc">Paddle</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s2">&quot;x&quot;</span><span class="n">s</span>
            <span class="kr">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s2">&quot;o&quot;</span><span class="n">s</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="n">s</span>
    <span class="n">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="c1"># Return current player or special value if game is done</span>
<span class="kn">fun</span> <span class="n">get_current_player</span><span class="p">(</span><span class="nc">Game</span> <span class="n">g</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">if</span> <span class="n">g</span><span class="p">.</span><span class="n">is_done</span><span class="p">():</span>
        <span class="kr">return</span> <span class="o">-</span><span class="mi">4</span>  <span class="c1"># Terminal state</span>
    <span class="kr">let</span> <span class="n">column</span> <span class="p">:</span> <span class="nc">Column</span>
    <span class="kr">if</span> <span class="n">can</span> <span class="n">g</span><span class="p">.</span><span class="n">set_start_location</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
        <span class="kr">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="kr">return</span> <span class="mi">0</span>  <span class="c1"># Player 0 (the only player)</span>

<span class="c1"># Return score for ML training</span>
<span class="kn">fun</span> <span class="n">score</span><span class="p">(</span><span class="nc">Game</span> <span class="n">g</span><span class="p">,</span> <span class="nc">Int</span> <span class="n">player_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Float</span><span class="p">:</span>
    <span class="kr">if</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">is_done</span><span class="p">():</span>
        <span class="kr">return</span> <span class="mf">0.0</span>
    <span class="kr">if</span> <span class="n">g</span><span class="p">.</span><span class="n">paddle_col</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">g</span><span class="p">.</span><span class="n">ball_col</span><span class="p">.</span><span class="n">value</span><span class="p">:</span>
        <span class="kr">return</span> <span class="mf">1.0</span>
    <span class="kr">else</span><span class="p">:</span>
        <span class="kr">return</span> <span class="mf">0.0</span>

<span class="c1"># Return number of players (always 1 for this game)</span>
<span class="kn">fun</span> <span class="n">get_num_players</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">return</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The program is simply run with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rlc</span><span class="o">-</span><span class="n">learn</span> <span class="n">file</span><span class="o">.</span><span class="n">rl</span> <span class="o">-</span><span class="n">o</span> <span class="n">network</span> <span class="c1">#ctrl+c to stop it after a while</span>
<span class="n">rlc</span><span class="o">-</span><span class="n">play</span> <span class="n">file</span><span class="o">.</span><span class="n">rk</span> <span class="n">network</span> <span class="c1"># to see a game</span>
</pre></div>
</div>
<p>The user never had to specify anything related to reinforcement learning. They simply defined the environment’s rules—and everything else was inferred automatically.</p>
<p>The system learns to maximize the score based on how the game works. That score can be visualized later, making this approach valuable in two ways:</p>
<ul class="simple">
<li><p>To determine the <strong>maximum achievable performance</strong> of a program.</p></li>
<li><p>To verify that the program behaves <strong>as expected</strong>—and that internal variables don’t take on surprising or incorrect values.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="self-configuring-uis">
<h2>Self-Configuring UIs<a class="headerlink" href="#self-configuring-uis" title="Link to this heading"></a></h2>
<p>One of Rulebook’s unique strengths is that it <strong>exposes all action types</strong> available in an action function. This allows UI code to:</p>
<ul class="simple">
<li><p>Inspect the current program state.</p></li>
<li><p>Determine which actions are currently valid.</p></li>
<li><p>Adapt dynamically to changes in application logic.</p></li>
</ul>
<section id="example-ui-for-tic-tac-toe">
<h3>Example: UI for Tic-Tac-Toe<a class="headerlink" href="#example-ui-for-tic-tac-toe" title="Link to this heading"></a></h3>
<p>Imagine you’re building a UI for a tic-tac-toe game. You’ve created 9 square components, one for each cell. Each square should:</p>
<ul class="simple">
<li><p>Flash when it can be clicked.</p></li>
<li><p>Show its current content (empty, X, or O).</p></li>
<li><p>Work correctly even if game rules change.</p></li>
</ul>
<p>Using action classes, you can achieve all of that with minimal coupling:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="n">classes</span>
<span class="kn">act</span> <span class="n">play</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="kn">frm</span> <span class="n">board</span> <span class="p">:</span> <span class="nc">Board</span>
    <span class="kr">while</span> <span class="o">!</span><span class="n">board</span><span class="p">.</span><span class="n">full</span><span class="p">():</span>
        <span class="kn">act</span> <span class="n">mark</span><span class="p">(</span><span class="nc">BInt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">,</span> <span class="nc">BInt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">board</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="n">board</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">current_player</span><span class="p">())</span>

        <span class="kr">if</span> <span class="n">board</span><span class="p">.</span><span class="n">three_in_a_line_player</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">current_player</span><span class="p">()):</span>
            <span class="kr">return</span>
        <span class="n">board</span><span class="p">.</span><span class="n">next_turn</span><span class="p">()</span>

<span class="kn">cls</span> <span class="nc">UISquare</span><span class="p">:</span>
    <span class="nc">Int</span> <span class="n">x</span>
    <span class="nc">Int</span> <span class="n">y</span>

    <span class="n">def</span> <span class="n">update</span><span class="p">(</span><span class="nc">Game</span> <span class="n">state</span><span class="p">):</span>
        <span class="kr">let</span> <span class="n">action</span> <span class="o">=</span> <span class="nc">GameMark</span>
        <span class="n">action</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">action</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="kr">if</span> <span class="n">can</span> <span class="n">apply</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
            <span class="n">render_quad</span><span class="p">(</span><span class="n">glow</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="kr">else</span> <span class="kr">if</span> <span class="n">state</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">slots</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">render_quad</span><span class="p">(</span><span class="n">grey</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="kr">else</span> <span class="kr">if</span> <span class="n">state</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">slots</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">render_quad</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="kr">else</span><span class="p">:</span>
            <span class="n">render_quad</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="kn">fun</span> <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Int</span><span class="p">:</span>
    <span class="kr">let</span> <span class="n">state</span> <span class="o">=</span> <span class="n">play</span><span class="p">()</span>
    <span class="kr">let</span> <span class="n">ui_quads</span> <span class="o">=</span> <span class="n">make_quads</span><span class="p">()</span>
    <span class="kr">while</span> <span class="l">true</span><span class="p">:</span>
        <span class="kr">for</span> <span class="n">quad</span> <span class="kr">in</span> <span class="n">ui_quads</span><span class="p">:</span>
            <span class="n">quad</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">poll_and_apply_events</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="kr">return</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This UI is entirely driven by:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">board</span></code> data structure.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">mark</span></code> action and its <code class="docutils literal notranslate"><span class="pre">can</span></code> condition.</p></li>
</ul>
<p>As long as these remain consistent, the UI will continue to function—even if the game rules or logic change behind the scenes. This makes Rulebook a natural fit for <strong>self-configuring, resilient user interfaces</strong>.</p>
</section>
</section>
<hr class="docutils" />
<section id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Link to this heading"></a></h2>
<p>Rulebook offers <strong>bidirectional interoperability</strong> with:</p>
<ul class="simple">
<li><p>C</p></li>
<li><p>C++</p></li>
<li><p>Python</p></li>
<li><p>C#</p></li>
<li><p>Godot</p></li>
</ul>
<section id="example-c-interop">
<h3>Example: C# Interop<a class="headerlink" href="#example-c-interop" title="Link to this heading"></a></h3>
<p>Here’s how a C# program might interact with a Rulebook coroutine:</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">act</span> <span class="n">play</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="kn">frm</span> <span class="n">local_var</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kn">act</span> <span class="n">pick</span><span class="p">(</span><span class="nc">Int</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">local_var</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Tester</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Game</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RLC</span><span class="p">.</span><span class="n">play</span><span class="p">();</span>
<span class="w">        </span><span class="n">pair</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">pair</span><span class="p">.</span><span class="n">local_var</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To take full advantage of Rulebook’s features, it’s recommended to use only <strong>copyable and default-constructible types</strong> inside Rulebook programs. If that’s not possible, you can use the <code class="docutils literal notranslate"><span class="pre">ctx</span></code> feature to inject context objects for handling non-copyable types outside the coroutine.</p>
<p>All advanced features in Rulebook are <strong>opt-in</strong>. If you don’t use them, you pay <strong>no performance or complexity cost</strong>. For example:</p>
<ul class="simple">
<li><p>You can apply <a class="reference internal" href="#finite-interactive-programs"><span class="xref myst">enumerate</span></a> only to testable UI components, even if the full system is not finite.</p></li>
<li><p>You can use reinforcement learning selectively, or avoid it altogether.</p></li>
<li><p>You can rely on trace replay only in subsystems where time-invariance holds.</p></li>
</ul>
<p>Rulebook is designed to <strong>scale gracefully</strong> based on the features you choose to use.</p>
<p>More on interoperability <a class="reference internal" href="interoperating.html"><span class="std std-doc">here</span></a>.</p>
</section>
</section>
<hr class="docutils" />
<section id="remote-execution">
<h2>Remote Execution<a class="headerlink" href="#remote-execution" title="Link to this heading"></a></h2>
<p>Since Rulebook supports <a class="reference internal" href="#serializable"><span class="xref myst">serialization</span></a> for <a class="reference internal" href="#action-statement-classes"><span class="xref myst">action statement classes</span></a> and is <a class="reference internal" href="#compatibility"><span class="xref myst">interoperable</span></a> across multiple languages, <strong>remote execution</strong> can be implemented at the <strong>action trace level</strong>.</p>
<p>That means:</p>
<ul class="simple">
<li><p>You can run identical programs in two separate processes (even across languages).</p></li>
<li><p>As one instance executes actions, the trace can be sent to and replayed by the other.</p></li>
</ul>
<p>This enables powerful distributed testing and simulation scenarios, and it’s already used in the <a class="reference external" href="https://github.com/rl-language/4Hammer">4Hammer project</a>. It’s a natural extension of Rulebook’s <a class="reference internal" href="#spin-function-implications"><span class="xref myst">SPIN function</span></a> architecture.</p>
</section>
<hr class="docutils" />
<section id="tooling">
<h2>Tooling<a class="headerlink" href="#tooling" title="Link to this heading"></a></h2>
<p>Rulebook includes a growing suite of development tools:</p>
<ul class="simple">
<li><p><strong>Autocomplete</strong> for Visual Studio Code and any editor with LSP (Language Server Protocol) support.</p></li>
<li><p><strong>Language bindings</strong> with autocomplete for each supported language (e.g., C#, Python).</p></li>
<li><p><strong>Basic GDB support</strong>, though debugging is rarely needed due to the power of:</p>
<ul>
<li><p>Trace replay</p></li>
<li><p>Fuzz testing</p></li>
<li><p>Serialization</p></li>
</ul>
</li>
</ul>
<p>The <a class="reference external" href="https://github.com/rl-language/4Hammer">4Hammer</a> example was written <strong>without a debugger</strong>, relying solely on Rulebook’s core tooling. That said, if debugging support is important to you, let the team know—it’s an area they’re actively improving.</p>
</section>
<hr class="docutils" />
<section id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Link to this heading"></a></h2>
<p>Rulebook is designed for <strong>near-native performance</strong>, without sacrificing flexibility:</p>
<ul class="simple">
<li><p><strong>Action functions</strong> are stack-allocated coroutines.</p></li>
<li><p>Each one uses a single integer to track its resume point.</p></li>
<li><p><strong>Structs</strong> match the C ABI exactly.</p></li>
<li><p><strong>Unions</strong> are like C unions, with one added integer to indicate the active variant.</p></li>
<li><p><strong>All arguments are passed by reference</strong>, and return values are by value (unless marked <code class="docutils literal notranslate"><span class="pre">ref</span></code>).</p></li>
</ul>
<p>The only performance trade-off comes from serialization:</p>
<ul class="simple">
<li><p>Rulebook uses <strong>integer indices</strong> instead of raw pointers, so all structures can be stored and restored safely.</p></li>
<li><p>If absolute speed is needed, you can manually manage pointers and specify how they’re serialized/deserialized.</p></li>
</ul>
<p>Importantly, <strong>any other language offering equivalent serialization guarantees would face similar trade-offs</strong>. Rulebook just makes the implications explicit.</p>
<p>We benchmark performance against C++ in the official language paper.</p>
<blockquote>
<div><p><em>ToDo: Add link to the paper after de-anonymization.</em></p>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Rulebook Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="the_inversion_of_control_problem.html" class="btn btn-neutral float-right" title="Interactive Inversion of control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Massimo Fioravanti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>