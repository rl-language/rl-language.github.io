

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4Hammer &mdash; Rulebook documentation 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e259d695"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Rulebook Language" href="language-reference.html" />
    <link rel="prev" title="UI, Controller, and Gameplay" href="ui_gameplay.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Rulebook documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Concepts:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language_tour.html">Language Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_inversion_of_control_problem.html">Interactive Inversion of control</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_rationale.html">Graphic engines and machine learning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rlc.html">RLC</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building RLC from sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="interoperating.html">Interoperation with engines and languages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reinforcement Learning Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial for RL people</a></li>
<li class="toctree-l1"><a class="reference internal" href="gym_tutorial.html">RLC and GYM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UIs, Controllers, Gameplay:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ui_gameplay.html">UI, Controller, and Gameplay</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4Hammer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-size-of-the-problem">The Size of the Problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scope">Scope</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-the-games-complexity">Visualizing the Game’s Complexity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rolling-a-die">Rolling a Die</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#core-rules">Core Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variants-of-rerolling">Variants of Rerolling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-requirements-from-4hammer">Additional Requirements from 4Hammer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpp-implementation">CPP Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rulebook-implementation">Rulebook Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#software-architecture">Software architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hammer-graphical-engine">4Hammer graphical engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-drivers">Python drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fuzzer">Fuzzer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#self-configuring-ui">Self configuring UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-autoconfigurations">Supported autoconfigurations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#remote-execution">Remote execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Python drivers</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language-reference.html">Rulebook Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib/index.html">stdlib</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rulebook documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">4Hammer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/4hammer.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="hammer">
<h1>4Hammer<a class="headerlink" href="#hammer" title="Link to this heading"></a></h1>
<p>Our flagship example is <strong>4Hammer</strong> (<a class="reference external" href="https://github.com/rl-language/4Hammer">source code</a>), a reinforcement learning environment that encodes <strong>extremely complex interactive sequences</strong> in just ~5,000 lines of code—including the graphics.</p>
<p>Thanks to Rulebook, 4Hammer automatically gains:</p>
<ul class="simple">
<li><p>Reinforcement learning support</p></li>
<li><p>Fuzzer-based testing</p></li>
<li><p>Textual state encoding</p></li>
<li><p>Trace replay</p></li>
<li><p>Remote execution</p></li>
<li><p>Self-configuring UIs</p></li>
</ul>
<p>—all available in both <strong>browser</strong> and <strong>desktop</strong> builds.</p>
<p>Depending on the complexity of the problem 4Hammer is addressing, 5,000 lines of code might seem like a lot—or not. It’s difficult to make a direct comparison, but at feature parity, we believe that using another language would have required <strong>5 to 20 times more code</strong>, depending on the language and tooling.</p>
<p>The project rationale is explained in detail in the related <a class="reference external" href="https://arxiv.org/abs/2505.13638">paper</a></p>
<hr class="docutils" />
<section id="the-size-of-the-problem">
<h2>The Size of the Problem<a class="headerlink" href="#the-size-of-the-problem" title="Link to this heading"></a></h2>
<p>4Hammer implements a digital version of <a class="reference external" href="https://en.wikipedia.org/wiki/Warhammer_40,000">Warhammer 40,000</a>, designed specifically for <strong>validating reinforcement learning environments</strong>.</p>
<p>Warhammer 40,000 is the most-played miniature board game in the world, with <strong>hundreds of thousands of games</strong> played at a competitive level each year. The community is deeply invested in understanding the game better and has already built tools in narrow domains (like dice probability calculators). But <strong>general simulation of the full game is currently intractable</strong>.</p>
<p>Challenges include:</p>
<ul class="simple">
<li><p>Hundreds of unique game units, each with slight rule variations and quirks.</p></li>
<li><p>Rule interactions that require <strong>physics simulation</strong> to resolve spatial mechanics.</p></li>
<li><p>Highly <strong>non-linear interactive sequences</strong>, where small state differences can completely change the legal set of actions.
<em>(Example: applying the special rules <strong>Torrent</strong> and <strong>Devastating Wounds</strong> to a unit fundamentally alters its behavior during the <strong>Single Attack</strong> sequence.)</em></p></li>
<li><p>Frequent updates from the publisher, making full digital replication difficult to maintain.</p></li>
</ul>
<hr class="docutils" />
<section id="scope">
<h3>Scope<a class="headerlink" href="#scope" title="Link to this heading"></a></h3>
<p>4Hammer does <strong>not</strong> aim to fully implement:</p>
<ul class="simple">
<li><p>Every single unit profile (there are hundreds).</p></li>
<li><p>A full physics simulation of the game.</p></li>
</ul>
<p>These features aren’t necessary unless you’re building a <strong>perfect digital twin</strong> for resale or official use.</p>
<p>Instead, 4Hammer focuses on:</p>
<ul class="simple">
<li><p>Implementing all core rules required to play <strong>6 out of the 35</strong> factions.</p></li>
<li><p>Using <strong>Combat Patrol mode</strong> as the scenario baseline.</p></li>
<li><p>Enabling <strong>neural networks</strong> to interact with complex strategic mechanics.</p></li>
</ul>
<p>This scope is sufficient for training and validating learning agents at the <strong>strategic level</strong>—deciding how to allocate resources and respond to game events. Once this is solved, we can begin layering in more detailed tactical rules (e.g. unit placement, collisions, line of sight) and move toward <strong>superhuman play</strong> under the full rule set of Warhammer 40,000.</p>
</section>
<hr class="docutils" />
<section id="visualizing-the-games-complexity">
<h3>Visualizing the Game’s Complexity<a class="headerlink" href="#visualizing-the-games-complexity" title="Link to this heading"></a></h3>
<p>The image below shows <strong>all possible interactive actions</strong> available to the player in the 4Hammer implementation.</p>
<ul class="simple">
<li><p><strong>Edges</strong> indicate that RLC believes the action at the target of the arrow can sometimes—or always—follow the source action.</p></li>
<li><p><strong>Diamonds</strong> represent <strong>decision points</strong>, where the player must choose between multiple next actions.</p></li>
<li><p><strong>Solid boxes</strong> represent <strong>atomic choices</strong>, such as deciding whether to use an optional rule.</p></li>
<li><p><strong>Dashed boxes</strong> denote the <strong>invocation of a sub-interactive sequence</strong>.</p></li>
</ul>
<div class="graphviz"><img src="_images/graphviz-f49241d0bd97f61f147e51f135597cdd3079e45f.png" alt="digraph g {
&quot;0x615cd69d1760&quot;[shape=ellipse, label=&quot;evaluate_random_stat&quot;, style=solid]
&quot;0x615cd69d1760&quot; -&gt; &quot;0x615cd69d17f0&quot;
&quot;0x615cd69d1760&quot; -&gt; &quot;0x615cd69d3e50&quot;
&quot;0x615cd69d17f0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69d3e50&quot;[shape=box, label=&quot;quantity&quot;, style=solid]
&quot;0x615cd69d3e50&quot; -&gt; &quot;0x615cd69d17f0&quot;
&quot;0x615cd6943ae0&quot;[shape=box, label=&quot;reroll_pair&quot;, style=solid]
&quot;0x615cd6943ae0&quot; -&gt; &quot;0x615cd69d4c40&quot;
&quot;0x615cd69a20b0&quot;[shape=ellipse, label=&quot;rerollable_pair_dices_roll&quot;, style=solid]
&quot;0x615cd69a20b0&quot; -&gt; &quot;0x615cd69a6330&quot;
&quot;0x615cd69a38b0&quot;[shape=box, label=&quot;keep_it&quot;, style=solid]
&quot;0x615cd69a38b0&quot; -&gt; &quot;0x615cd69d4c40&quot;
&quot;0x615cd69a38b0&quot; -&gt; &quot;0x615cd6943ae0&quot;
&quot;0x615cd69a6330&quot;[shape=box, label=&quot;roll_pair&quot;, style=solid]
&quot;0x615cd69a6330&quot; -&gt; &quot;0x615cd69d4c40&quot;
&quot;0x615cd69a6330&quot; -&gt; &quot;0x615cd69a38b0&quot;
&quot;0x615cd69d4c40&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69484e0&quot;[shape=ellipse, label=&quot;rerollable_dice_roll&quot;, style=solid]
&quot;0x615cd69484e0&quot; -&gt; &quot;0x615cd69984f0&quot;
&quot;0x615cd6948780&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69984f0&quot;[shape=box, label=&quot;roll&quot;, style=solid]
&quot;0x615cd69984f0&quot; -&gt; &quot;0x615cd6948780&quot;
&quot;0x615cd69984f0&quot; -&gt; &quot;0x615cd69cb3b0&quot;
&quot;0x615cd69cb3b0&quot;[shape=box, label=&quot;keep_it&quot;, style=solid]
&quot;0x615cd69cb3b0&quot; -&gt; &quot;0x615cd6948780&quot;
&quot;0x615cd69cb3b0&quot; -&gt; &quot;0x615cd69d1be0&quot;
&quot;0x615cd69d1be0&quot;[shape=box, label=&quot;reroll&quot;, style=solid]
&quot;0x615cd69d1be0&quot; -&gt; &quot;0x615cd6948780&quot;
&quot;0x615cd694bf00&quot;[shape=box, label=&quot;devastating_damage_roll&quot;, style=dotted]
&quot;0x615cd694bf00&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd694bf00&quot; -&gt; &quot;0x615cd6a0e2e0&quot;
&quot;0x615cd694bf00&quot; -&gt; &quot;0x615cd6a02200&quot;
&quot;0x615cd69da5b0&quot;[shape=box, label=&quot;damage_roll&quot;, style=dotted]
&quot;0x615cd69da5b0&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd69da5b0&quot; -&gt; &quot;0x615cd69db690&quot;
&quot;0x615cd69da5b0&quot; -&gt; &quot;0x615cd6a14040&quot;
&quot;0x615cd69db690&quot;[shape=box, label=&quot;on_model_destroyed&quot;, style=dotted]
&quot;0x615cd69db690&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd69f7270&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69fa690&quot;[shape=ellipse, label=&quot;single_attack&quot;, style=solid]
&quot;0x615cd69fa690&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd69fa690&quot; -&gt; &quot;0x615cd6a0e2e0&quot;
&quot;0x615cd69fa690&quot; -&gt; &quot;0x615cd69fbbe0&quot;
&quot;0x615cd69fa690&quot; -&gt; &quot;0x615cd6a02200&quot;
&quot;0x615cd69fbbe0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd69fbbe0&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd69fbbe0&quot; -&gt; &quot;0x615cd6a0e2e0&quot;
&quot;0x615cd69fbbe0&quot; -&gt; &quot;0x615cd6a02200&quot;
&quot;0x615cd6a02200&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a02200&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd6a02200&quot; -&gt; &quot;0x615cd6a0e2e0&quot;
&quot;0x615cd6a02200&quot; -&gt; &quot;0x615cd694bf00&quot;
&quot;0x615cd6a02200&quot; -&gt; &quot;0x615cd6a02200&quot;
&quot;0x615cd6a0e2e0&quot;[shape=box, label=&quot;allocate_wound&quot;, style=solid]
&quot;0x615cd6a0e2e0&quot; -&gt; &quot;0x615cd69f7270&quot;
&quot;0x615cd6a0e2e0&quot; -&gt; &quot;0x615cd69db690&quot;
&quot;0x615cd6a0e2e0&quot; -&gt; &quot;0x615cd6a14040&quot;
&quot;0x615cd6a14040&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a14040&quot; -&gt; &quot;0x615cd69da5b0&quot;
&quot;0x615cd69ab780&quot;[shape=box, label=&quot;roll&quot;, style=solid]
&quot;0x615cd69ab780&quot; -&gt; &quot;0x615cd69d7be0&quot;
&quot;0x615cd69acf70&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd69acf70&quot; -&gt; &quot;0x615cd69d7be0&quot;
&quot;0x615cd69ad060&quot;[shape=box, label=&quot;use_violent_unbidding&quot;, style=solid]
&quot;0x615cd69ad060&quot; -&gt; &quot;0x615cd69d96f0&quot;
&quot;0x615cd69d7a90&quot;[shape=ellipse, label=&quot;on_model_destroyed&quot;, style=solid]
&quot;0x615cd69d7a90&quot; -&gt; &quot;0x615cd69e5670&quot;
&quot;0x615cd69d7a90&quot; -&gt; &quot;0x615cd69d7be0&quot;
&quot;0x615cd69d7be0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69d96f0&quot;[shape=box, label=&quot;roll&quot;, style=solid]
&quot;0x615cd69d96f0&quot; -&gt; &quot;0x615cd69ab780&quot;
&quot;0x615cd69d96f0&quot; -&gt; &quot;0x615cd69d7be0&quot;
&quot;0x615cd69e5670&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd69e5670&quot; -&gt; &quot;0x615cd69acf70&quot;
&quot;0x615cd69e5670&quot; -&gt; &quot;0x615cd69ad060&quot;
&quot;0x615cd69ede10&quot;[shape=box, label=&quot;attack&quot;, style=dotted]
&quot;0x615cd69ede10&quot; -&gt; &quot;0x615cd69ede10&quot;
&quot;0x615cd69ede10&quot; -&gt; &quot;0x615cd69f2a40&quot;
&quot;0x615cd69f2800&quot;[shape=ellipse, label=&quot;resolve_weapon&quot;, style=solid]
&quot;0x615cd69f2800&quot; -&gt; &quot;0x615cd69f42c0&quot;
&quot;0x615cd69f2a40&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69f42c0&quot;[shape=box, label=&quot;attacks_roll&quot;, style=dotted]
&quot;0x615cd69f42c0&quot; -&gt; &quot;0x615cd69ede10&quot;
&quot;0x615cd69f42c0&quot; -&gt; &quot;0x615cd69f2a40&quot;
&quot;0x615cd69f1240&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a34d00&quot;[shape=ellipse, label=&quot;resolve_model_attack&quot;, style=solid]
&quot;0x615cd6a34d00&quot; -&gt; &quot;0x615cd69f1240&quot;
&quot;0x615cd6a34d00&quot; -&gt; &quot;0x615cd6a3ca30&quot;
&quot;0x615cd6a35970&quot;[shape=box, label=&quot;select_weapon&quot;, style=solid]
&quot;0x615cd6a35970&quot; -&gt; &quot;0x615cd6a3cf40&quot;
&quot;0x615cd6a3c800&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6a3c800&quot; -&gt; &quot;0x615cd69f1240&quot;
&quot;0x615cd6a3ca30&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6a3ca30&quot; -&gt; &quot;0x615cd6a3c800&quot;
&quot;0x615cd6a3ca30&quot; -&gt; &quot;0x615cd6a35970&quot;
&quot;0x615cd6a3cf40&quot;[shape=box, label=&quot;resolve_weapon&quot;, style=dotted]
&quot;0x615cd6a3cf40&quot; -&gt; &quot;0x615cd69f1240&quot;
&quot;0x615cd6a3cf40&quot; -&gt; &quot;0x615cd6a3ca30&quot;
&quot;0x615cd695d090&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd695d090&quot; -&gt; &quot;0x615cd6a4cdc0&quot;
&quot;0x615cd695d090&quot; -&gt; &quot;0x615cd6a4ccd0&quot;
&quot;0x615cd695d090&quot; -&gt; &quot;0x615cd6a50990&quot;
&quot;0x615cd695d090&quot; -&gt; &quot;0x615cd6a54a40&quot;
&quot;0x615cd695d090&quot; -&gt; &quot;0x615cd6a5b6a0&quot;
&quot;0x615cd695d090&quot; -&gt; &quot;0x615cd6a581b0&quot;
&quot;0x615cd6a40890&quot;[shape=ellipse, label=&quot;use_attack_stratagems&quot;, style=solid]
&quot;0x615cd6a40890&quot; -&gt; &quot;0x615cd6a4c230&quot;
&quot;0x615cd6a40b00&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a417e0&quot;[shape=box, label=&quot;no_defensive_stratagem&quot;, style=solid]
&quot;0x615cd6a417e0&quot; -&gt; &quot;0x615cd695d090&quot;
&quot;0x615cd6a428e0&quot;[shape=box, label=&quot;tough_as_squig_hide&quot;, style=solid]
&quot;0x615cd6a428e0&quot; -&gt; &quot;0x615cd695d090&quot;
&quot;0x615cd6a44600&quot;[shape=box, label=&quot;use_gene_wrought_resiliance&quot;, style=solid]
&quot;0x615cd6a44600&quot; -&gt; &quot;0x615cd695d090&quot;
&quot;0x615cd6a470b0&quot;[shape=box, label=&quot;use_daemonic_fervour&quot;, style=solid]
&quot;0x615cd6a470b0&quot; -&gt; &quot;0x615cd695d090&quot;
&quot;0x615cd6a48cc0&quot;[shape=box, label=&quot;use_unyielding&quot;, style=solid]
&quot;0x615cd6a48cc0&quot; -&gt; &quot;0x615cd695d090&quot;
&quot;0x615cd6a4c230&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6a4c230&quot; -&gt; &quot;0x615cd6a44600&quot;
&quot;0x615cd6a4c230&quot; -&gt; &quot;0x615cd6a428e0&quot;
&quot;0x615cd6a4c230&quot; -&gt; &quot;0x615cd6a470b0&quot;
&quot;0x615cd6a4c230&quot; -&gt; &quot;0x615cd6a48cc0&quot;
&quot;0x615cd6a4c230&quot; -&gt; &quot;0x615cd6a417e0&quot;
&quot;0x615cd6a4ccd0&quot;[shape=box, label=&quot;no_offensive_stratagem&quot;, style=solid]
&quot;0x615cd6a4ccd0&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a4cdc0&quot;[shape=box, label=&quot;use_veteran_instincts&quot;, style=solid]
&quot;0x615cd6a4cdc0&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a504e0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a504e0&quot; -&gt; &quot;0x615cd6a535e0&quot;
&quot;0x615cd6a504e0&quot; -&gt; &quot;0x615cd6a529c0&quot;
&quot;0x615cd6a50990&quot;[shape=box, label=&quot;use_dark_pact&quot;, style=solid]
&quot;0x615cd6a50990&quot; -&gt; &quot;0x615cd6a504e0&quot;
&quot;0x615cd6a529c0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a529c0&quot; -&gt; &quot;0x615cd6a535e0&quot;
&quot;0x615cd6a535e0&quot;[shape=box, label=&quot;select_ability&quot;, style=solid]
&quot;0x615cd6a535e0&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a54a40&quot;[shape=box, label=&quot;use_swift_kill&quot;, style=solid]
&quot;0x615cd6a54a40&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a581b0&quot;[shape=box, label=&quot;use_vindictive_strategy&quot;, style=solid]
&quot;0x615cd6a581b0&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a59a20&quot;[shape=box, label=&quot;select_model&quot;, style=solid]
&quot;0x615cd6a59a20&quot; -&gt; &quot;0x615cd6a5f590&quot;
&quot;0x615cd6a59a20&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a5b6a0&quot;[shape=box, label=&quot;use_sacrificial_dagger&quot;, style=solid]
&quot;0x615cd6a5b6a0&quot; -&gt; &quot;0x615cd6a59a20&quot;
&quot;0x615cd6a5eeb0&quot;[shape=box, label=&quot;use_dacatarai_stance&quot;, style=solid]
&quot;0x615cd6a5eeb0&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a5f260&quot;[shape=box, label=&quot;use_rendax_stance&quot;, style=solid]
&quot;0x615cd6a5f260&quot; -&gt; &quot;0x615cd6a40b00&quot;
&quot;0x615cd6a5f590&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6a5f590&quot; -&gt; &quot;0x615cd6a5eeb0&quot;
&quot;0x615cd6a5f590&quot; -&gt; &quot;0x615cd6a5f260&quot;
&quot;0x615cd6a1dcb0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a1dcb0&quot; -&gt; &quot;0x615cd6a1e280&quot;
&quot;0x615cd6a1e280&quot;[shape=box, label=&quot;select_model&quot;, style=solid]
&quot;0x615cd6a1e280&quot; -&gt; &quot;0x615cd6a60460&quot;
&quot;0x615cd6a1e280&quot; -&gt; &quot;0x615cd6a21720&quot;
&quot;0x615cd6a1e280&quot; -&gt; &quot;0x615cd6a1ff50&quot;
&quot;0x615cd6a1e280&quot; -&gt; &quot;0x615cd6a1dcb0&quot;
&quot;0x615cd6a1ff50&quot;[shape=box, label=&quot;roll&quot;, style=solid]
&quot;0x615cd6a1ff50&quot; -&gt; &quot;0x615cd6a21720&quot;
&quot;0x615cd6a21720&quot;[shape=box, label=&quot;fight_on_death_attack&quot;, style=dotted]
&quot;0x615cd6a21720&quot; -&gt; &quot;0x615cd6a60460&quot;
&quot;0x615cd6a21720&quot; -&gt; &quot;0x615cd6a21720&quot;
&quot;0x615cd6a21720&quot; -&gt; &quot;0x615cd6a1ff50&quot;
&quot;0x615cd6a60120&quot;[shape=ellipse, label=&quot;attack&quot;, style=solid]
&quot;0x615cd6a60120&quot; -&gt; &quot;0x615cd6a60460&quot;
&quot;0x615cd6a60120&quot; -&gt; &quot;0x615cd6a62640&quot;
&quot;0x615cd6a60460&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a62640&quot;[shape=box, label=&quot;strats&quot;, style=dotted]
&quot;0x615cd6a62640&quot; -&gt; &quot;0x615cd6a60460&quot;
&quot;0x615cd6a62640&quot; -&gt; &quot;0x615cd6a21720&quot;
&quot;0x615cd6a62640&quot; -&gt; &quot;0x615cd6a1ff50&quot;
&quot;0x615cd6a62640&quot; -&gt; &quot;0x615cd6a1dcb0&quot;
&quot;0x615cd6a62640&quot; -&gt; &quot;0x615cd6a65940&quot;
&quot;0x615cd6a65940&quot;[shape=box, label=&quot;model_attack&quot;, style=dotted]
&quot;0x615cd6a65940&quot; -&gt; &quot;0x615cd6a60460&quot;
&quot;0x615cd6a65940&quot; -&gt; &quot;0x615cd6a21720&quot;
&quot;0x615cd6a65940&quot; -&gt; &quot;0x615cd6a1ff50&quot;
&quot;0x615cd6a65940&quot; -&gt; &quot;0x615cd6a1dcb0&quot;
&quot;0x615cd6a65940&quot; -&gt; &quot;0x615cd6a65940&quot;
&quot;0x615cd69e7150&quot;[shape=ellipse, label=&quot;spawn_unit&quot;, style=solid]
&quot;0x615cd69e7150&quot; -&gt; &quot;0x615cd6a26e90&quot;
&quot;0x615cd69e7210&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69e7860&quot;[shape=box, label=&quot;set_owner&quot;, style=solid]
&quot;0x615cd69e7860&quot; -&gt; &quot;0x615cd69ea7d0&quot;
&quot;0x615cd69e7b70&quot;[shape=box, label=&quot;place_at&quot;, style=solid]
&quot;0x615cd69e7b70&quot; -&gt; &quot;0x615cd69e7210&quot;
&quot;0x615cd69e8320&quot;[shape=box, label=&quot;place_in_reserve&quot;, style=solid]
&quot;0x615cd69e8320&quot; -&gt; &quot;0x615cd69e7210&quot;
&quot;0x615cd69ea7d0&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd69ea7d0&quot; -&gt; &quot;0x615cd69e8320&quot;
&quot;0x615cd69ea7d0&quot; -&gt; &quot;0x615cd69e7b70&quot;
&quot;0x615cd6a26e90&quot;[shape=box, label=&quot;spawn&quot;, style=solid]
&quot;0x615cd6a26e90&quot; -&gt; &quot;0x615cd69e7860&quot;
&quot;0x615cd69e96d0&quot;[shape=box, label=&quot;insane_bravery&quot;, style=solid]
&quot;0x615cd69e96d0&quot; -&gt; &quot;0x615cd6a28ea0&quot;
&quot;0x615cd69e96d0&quot; -&gt; &quot;0x615cd69eaae0&quot;
&quot;0x615cd69ea9c0&quot;[shape=ellipse, label=&quot;battle_shock_test&quot;, style=solid]
&quot;0x615cd69ea9c0&quot; -&gt; &quot;0x615cd69e96d0&quot;
&quot;0x615cd69ea9c0&quot; -&gt; &quot;0x615cd6a28ea0&quot;
&quot;0x615cd69eaae0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a28ea0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a28ea0&quot; -&gt; &quot;0x615cd69eaae0&quot;
&quot;0x615cd6a2b140&quot;[shape=ellipse, label=&quot;battle_shock_step&quot;, style=solid]
&quot;0x615cd6a2b140&quot; -&gt; &quot;0x615cd6a2b200&quot;
&quot;0x615cd6a2b140&quot; -&gt; &quot;0x615cd6aa22b0&quot;
&quot;0x615cd6a2b200&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6aa22b0&quot;[shape=box, label=&quot;shock_test&quot;, style=dotted]
&quot;0x615cd6aa22b0&quot; -&gt; &quot;0x615cd6a2b200&quot;
&quot;0x615cd6aa22b0&quot; -&gt; &quot;0x615cd6aa22b0&quot;
&quot;0x615cd6aa5190&quot;[shape=ellipse, label=&quot;shadow_in_the_warp&quot;, style=solid]
&quot;0x615cd6aa5190&quot; -&gt; &quot;0x615cd6aa57f0&quot;
&quot;0x615cd6aa5190&quot; -&gt; &quot;0x615cd6aa52b0&quot;
&quot;0x615cd6aa52b0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6aa57f0&quot;[shape=box, label=&quot;use_shadow_in_the_warp&quot;, style=solid]
&quot;0x615cd6aa57f0&quot; -&gt; &quot;0x615cd6aa52b0&quot;
&quot;0x615cd6aa57f0&quot; -&gt; &quot;0x615cd6aa7f50&quot;
&quot;0x615cd6aa7f50&quot;[shape=box, label=&quot;shock_test&quot;, style=dotted]
&quot;0x615cd6aa7f50&quot; -&gt; &quot;0x615cd6aa52b0&quot;
&quot;0x615cd6aa7f50&quot; -&gt; &quot;0x615cd6aa7f50&quot;
&quot;0x615cd6aa9b60&quot;[shape=ellipse, label=&quot;neural_disruption&quot;, style=solid]
&quot;0x615cd6aa9b60&quot; -&gt; &quot;0x615cd6aa9c50&quot;
&quot;0x615cd6aa9b60&quot; -&gt; &quot;0x615cd6ab07c0&quot;
&quot;0x615cd6aa9c50&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6aaa140&quot;[shape=box, label=&quot;select_neural_disruption_target&quot;, style=solid]
&quot;0x615cd6aaa140&quot; -&gt; &quot;0x615cd6aae560&quot;
&quot;0x615cd6aae560&quot;[shape=box, label=&quot;shock_test&quot;, style=dotted]
&quot;0x615cd6aae560&quot; -&gt; &quot;0x615cd6aa9c50&quot;
&quot;0x615cd6aae560&quot; -&gt; &quot;0x615cd6ab07c0&quot;
&quot;0x615cd6ab06d0&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6ab06d0&quot; -&gt; &quot;0x615cd6aa9c50&quot;
&quot;0x615cd6ab06d0&quot; -&gt; &quot;0x615cd6ab07c0&quot;
&quot;0x615cd6ab07c0&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6ab07c0&quot; -&gt; &quot;0x615cd6aaa140&quot;
&quot;0x615cd6ab07c0&quot; -&gt; &quot;0x615cd6ab06d0&quot;
&quot;0x615cd6ab0dd0&quot;[shape=ellipse, label=&quot;command_phase&quot;, style=solid]
&quot;0x615cd6ab0dd0&quot; -&gt; &quot;0x615cd6ab1b70&quot;
&quot;0x615cd6ab0e90&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6ab1b70&quot;[shape=box, label=&quot;shadow1&quot;, style=dotted]
&quot;0x615cd6ab1b70&quot; -&gt; &quot;0x615cd6ab24c0&quot;
&quot;0x615cd6ab24c0&quot;[shape=box, label=&quot;shadow2&quot;, style=dotted]
&quot;0x615cd6ab24c0&quot; -&gt; &quot;0x615cd6ab3de0&quot;
&quot;0x615cd6ab3de0&quot;[shape=box, label=&quot;neural_disruption&quot;, style=dotted]
&quot;0x615cd6ab3de0&quot; -&gt; &quot;0x615cd6ab6090&quot;
&quot;0x615cd6ab3de0&quot; -&gt; &quot;0x615cd6abd070&quot;
&quot;0x615cd6ab4620&quot;[shape=box, label=&quot;select_oath_of_moment_target&quot;, style=solid]
&quot;0x615cd6ab4620&quot; -&gt; &quot;0x615cd6ab9bb0&quot;
&quot;0x615cd6ab51f0&quot;[shape=box, label=&quot;use_duty_and_honour&quot;, style=solid]
&quot;0x615cd6ab51f0&quot; -&gt; &quot;0x615cd6abd070&quot;
&quot;0x615cd6ab5fa0&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6ab5fa0&quot; -&gt; &quot;0x615cd6ab9bb0&quot;
&quot;0x615cd6ab6090&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6ab6090&quot; -&gt; &quot;0x615cd6ab5fa0&quot;
&quot;0x615cd6ab6090&quot; -&gt; &quot;0x615cd6ab4620&quot;
&quot;0x615cd6ab7b00&quot;[shape=box, label=&quot;use_pheromone_trail&quot;, style=solid]
&quot;0x615cd6ab7b00&quot; -&gt; &quot;0x615cd6abd070&quot;
&quot;0x615cd6ab9bb0&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6ab9bb0&quot; -&gt; &quot;0x615cd6ab7b00&quot;
&quot;0x615cd6ab9bb0&quot; -&gt; &quot;0x615cd6ab51f0&quot;
&quot;0x615cd6ab9bb0&quot; -&gt; &quot;0x615cd6abc9f0&quot;
&quot;0x615cd6abc9f0&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6abc9f0&quot; -&gt; &quot;0x615cd6abd070&quot;
&quot;0x615cd6abd070&quot;[shape=box, label=&quot;shock_step&quot;, style=dotted]
&quot;0x615cd6abd070&quot; -&gt; &quot;0x615cd6ab0e90&quot;
&quot;0x615cd6abd6e0&quot;[shape=ellipse, label=&quot;overwatch&quot;, style=solid]
&quot;0x615cd6abd6e0&quot; -&gt; &quot;0x615cd6abd7a0&quot;
&quot;0x615cd6abd6e0&quot; -&gt; &quot;0x615cd6ac4f80&quot;
&quot;0x615cd6abd7a0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6abd9c0&quot;[shape=box, label=&quot;overwatch&quot;, style=solid]
&quot;0x615cd6abd9c0&quot; -&gt; &quot;0x615cd6ac3e00&quot;
&quot;0x615cd6ac0080&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6ac0080&quot; -&gt; &quot;0x615cd6abd7a0&quot;
&quot;0x615cd6ac3e00&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6ac3e00&quot; -&gt; &quot;0x615cd6abd7a0&quot;
&quot;0x615cd6ac4f80&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6ac4f80&quot; -&gt; &quot;0x615cd6ac0080&quot;
&quot;0x615cd6ac4f80&quot; -&gt; &quot;0x615cd6abd9c0&quot;
&quot;0x615cd69e5930&quot;[shape=ellipse, label=&quot;move&quot;, style=solid]
&quot;0x615cd69e5930&quot; -&gt; &quot;0x615cd69e5ab0&quot;
&quot;0x615cd69e5930&quot; -&gt; &quot;0x615cd69e5d20&quot;
&quot;0x615cd69e5ab0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69e5d20&quot;[shape=box, label=&quot;move_to&quot;, style=solid]
&quot;0x615cd69e5d20&quot; -&gt; &quot;0x615cd6ac83e0&quot;
&quot;0x615cd6ac83e0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6ac83e0&quot; -&gt; &quot;0x615cd69e5ab0&quot;
&quot;0x615cd6acb2a0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6acbe20&quot;[shape=ellipse, label=&quot;fight_step&quot;, style=solid]
&quot;0x615cd6acbe20&quot; -&gt; &quot;0x615cd6ad7720&quot;
&quot;0x615cd6acbe20&quot; -&gt; &quot;0x615cd6acb2a0&quot;
&quot;0x615cd6acde40&quot;[shape=box, label=&quot;end_fight_step&quot;, style=solid]
&quot;0x615cd6acde40&quot; -&gt; &quot;0x615cd6ad7720&quot;
&quot;0x615cd6acde40&quot; -&gt; &quot;0x615cd6acb2a0&quot;
&quot;0x615cd6aceb00&quot;[shape=box, label=&quot;select_target&quot;, style=solid]
&quot;0x615cd6aceb00&quot; -&gt; &quot;0x615cd6ad3c90&quot;
&quot;0x615cd6ad3c90&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6ad3c90&quot; -&gt; &quot;0x615cd6ad7720&quot;
&quot;0x615cd6ad3c90&quot; -&gt; &quot;0x615cd6acb2a0&quot;
&quot;0x615cd6ad7720&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6ad7720&quot; -&gt; &quot;0x615cd6acde40&quot;
&quot;0x615cd6ad7720&quot; -&gt; &quot;0x615cd6aceb00&quot;
&quot;0x615cd6ad7910&quot;[shape=ellipse, label=&quot;fight_phase&quot;, style=solid]
&quot;0x615cd6ad7910&quot; -&gt; &quot;0x615cd6adcab0&quot;
&quot;0x615cd6ad7910&quot; -&gt; &quot;0x615cd6adbe40&quot;
&quot;0x615cd6ad79d0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6ad85e0&quot;[shape=box, label=&quot;use_bestial_bellow&quot;, style=solid]
&quot;0x615cd6ad85e0&quot; -&gt; &quot;0x615cd6ada750&quot;
&quot;0x615cd6ada750&quot;[shape=box, label=&quot;shock_test&quot;, style=dotted]
&quot;0x615cd6ada750&quot; -&gt; &quot;0x615cd6adbe40&quot;
&quot;0x615cd6adbe40&quot;[shape=box, label=&quot;fight_first_step&quot;, style=dotted]
&quot;0x615cd6adbe40&quot; -&gt; &quot;0x615cd6add1b0&quot;
&quot;0x615cd6adc9c0&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6adc9c0&quot; -&gt; &quot;0x615cd6adbe40&quot;
&quot;0x615cd6adcab0&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6adcab0&quot; -&gt; &quot;0x615cd6ad85e0&quot;
&quot;0x615cd6adcab0&quot; -&gt; &quot;0x615cd6adc9c0&quot;
&quot;0x615cd6add1b0&quot;[shape=box, label=&quot;fight_step&quot;, style=dotted]
&quot;0x615cd6add1b0&quot; -&gt; &quot;0x615cd6ad79d0&quot;
&quot;0x615cd6ade620&quot;[shape=ellipse, label=&quot;charge&quot;, style=solid]
&quot;0x615cd6ade620&quot; -&gt; &quot;0x615cd6ade860&quot;
&quot;0x615cd6ade620&quot; -&gt; &quot;0x615cd6ae0c90&quot;
&quot;0x615cd6ade620&quot; -&gt; &quot;0x615cd6aded50&quot;
&quot;0x615cd6ade860&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6aded50&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6aded50&quot; -&gt; &quot;0x615cd6ade860&quot;
&quot;0x615cd6aded50&quot; -&gt; &quot;0x615cd6ae0c90&quot;
&quot;0x615cd6ae0c90&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6ae0c90&quot; -&gt; &quot;0x615cd6ade860&quot;
&quot;0x615cd6ae46a0&quot;[shape=ellipse, label=&quot;charge_phase&quot;, style=solid]
&quot;0x615cd6ae46a0&quot; -&gt; &quot;0x615cd6ae4760&quot;
&quot;0x615cd6ae46a0&quot; -&gt; &quot;0x615cd6af4fb0&quot;
&quot;0x615cd6ae4760&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6ae5ef0&quot;[shape=box, label=&quot;end_charge&quot;, style=solid]
&quot;0x615cd6ae5ef0&quot; -&gt; &quot;0x615cd6ae4760&quot;
&quot;0x615cd6ae5ef0&quot; -&gt; &quot;0x615cd6af4fb0&quot;
&quot;0x615cd6ae6180&quot;[shape=box, label=&quot;select_target&quot;, style=solid]
&quot;0x615cd6ae6180&quot; -&gt; &quot;0x615cd6aeed40&quot;
&quot;0x615cd6aec290&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6aec290&quot; -&gt; &quot;0x615cd6aec830&quot;
&quot;0x615cd6aec3b0&quot;[shape=box, label=&quot;use_overawing_magnificence&quot;, style=solid]
&quot;0x615cd6aec3b0&quot; -&gt; &quot;0x615cd6aec830&quot;
&quot;0x615cd6aec830&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6aec830&quot; -&gt; &quot;0x615cd6af4de0&quot;
&quot;0x615cd6aec930&quot;[shape=box, label=&quot;use_heroic_intervention&quot;, style=solid]
&quot;0x615cd6aec930&quot; -&gt; &quot;0x615cd6af3a60&quot;
&quot;0x615cd6aeed40&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6aeed40&quot; -&gt; &quot;0x615cd6aec290&quot;
&quot;0x615cd6aeed40&quot; -&gt; &quot;0x615cd6aec3b0&quot;
&quot;0x615cd6aeef80&quot;[shape=box, label=&quot;skip&quot;, style=solid]
&quot;0x615cd6aeef80&quot; -&gt; &quot;0x615cd6ae4760&quot;
&quot;0x615cd6aeef80&quot; -&gt; &quot;0x615cd6af4fb0&quot;
&quot;0x615cd6af3a60&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6af3a60&quot; -&gt; &quot;0x615cd6ae4760&quot;
&quot;0x615cd6af3a60&quot; -&gt; &quot;0x615cd6af4fb0&quot;
&quot;0x615cd6af4de0&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6af4de0&quot; -&gt; &quot;0x615cd6aec930&quot;
&quot;0x615cd6af4de0&quot; -&gt; &quot;0x615cd6aeef80&quot;
&quot;0x615cd6af4fb0&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6af4fb0&quot; -&gt; &quot;0x615cd6ae5ef0&quot;
&quot;0x615cd6af4fb0&quot; -&gt; &quot;0x615cd6ae6180&quot;
&quot;0x615cd6af4330&quot;[shape=box, label=&quot;select_reserve_unit&quot;, style=solid]
&quot;0x615cd6af4330&quot; -&gt; &quot;0x615cd6afc180&quot;
&quot;0x615cd6af5210&quot;[shape=ellipse, label=&quot;reserve_deployment&quot;, style=solid]
&quot;0x615cd6af5210&quot; -&gt; &quot;0x615cd6afc350&quot;
&quot;0x615cd6af5400&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6af6a60&quot;[shape=box, label=&quot;nothing_to_deploy&quot;, style=solid]
&quot;0x615cd6af6a60&quot; -&gt; &quot;0x615cd6af5400&quot;
&quot;0x615cd6af78f0&quot;[shape=box, label=&quot;place_at&quot;, style=solid]
&quot;0x615cd6af78f0&quot; -&gt; &quot;0x615cd6af5400&quot;
&quot;0x615cd6afbd40&quot;[shape=box, label=&quot;nothing_to_deploy&quot;, style=solid]
&quot;0x615cd6afbd40&quot; -&gt; &quot;0x615cd6af5400&quot;
&quot;0x615cd6afc180&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6afc180&quot; -&gt; &quot;0x615cd6af78f0&quot;
&quot;0x615cd6afc180&quot; -&gt; &quot;0x615cd6afbd40&quot;
&quot;0x615cd6afc350&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6afc350&quot; -&gt; &quot;0x615cd6af4330&quot;
&quot;0x615cd6afc350&quot; -&gt; &quot;0x615cd6af6a60&quot;
&quot;0x615cd6afc5b0&quot;[shape=ellipse, label=&quot;desperate_escape&quot;, style=solid]
&quot;0x615cd6afc5b0&quot; -&gt; &quot;0x615cd6afcdd0&quot;
&quot;0x615cd6afc5b0&quot; -&gt; &quot;0x615cd6b001a0&quot;
&quot;0x615cd6afc5b0&quot; -&gt; &quot;0x615cd6afc7a0&quot;
&quot;0x615cd6afc7a0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6afcdd0&quot;[shape=box, label=&quot;use_predators_not_prey&quot;, style=solid]
&quot;0x615cd6afcdd0&quot; -&gt; &quot;0x615cd6afc7a0&quot;
&quot;0x615cd6b001a0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6b001a0&quot; -&gt; &quot;0x615cd6b001a0&quot;
&quot;0x615cd6b001a0&quot; -&gt; &quot;0x615cd6afc7a0&quot;
&quot;0x615cd6b02c00&quot;[shape=ellipse, label=&quot;movement&quot;, style=solid]
&quot;0x615cd6b02c00&quot; -&gt; &quot;0x615cd6b03290&quot;
&quot;0x615cd6b02c00&quot; -&gt; &quot;0x615cd6b048c0&quot;
&quot;0x615cd6b02d80&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6b03290&quot;[shape=box, label=&quot;desperate_escape&quot;, style=dotted]
&quot;0x615cd6b03290&quot; -&gt; &quot;0x615cd6b034b0&quot;
&quot;0x615cd6b034b0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6b034b0&quot; -&gt; &quot;0x615cd6b02d80&quot;
&quot;0x615cd6b048c0&quot;[shape=box, label=&quot;advance&quot;, style=solid]
&quot;0x615cd6b048c0&quot; -&gt; &quot;0x615cd6b062d0&quot;
&quot;0x615cd6b048c0&quot; -&gt; &quot;0x615cd6b080f0&quot;
&quot;0x615cd6b062d0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6b062d0&quot; -&gt; &quot;0x615cd6b02d80&quot;
&quot;0x615cd6b080f0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6b080f0&quot; -&gt; &quot;0x615cd6b098d0&quot;
&quot;0x615cd6b098d0&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6b098d0&quot; -&gt; &quot;0x615cd6b02d80&quot;
&quot;0x615cd6b09b60&quot;[shape=box, label=&quot;move_unit&quot;, style=solid]
&quot;0x615cd6b09b60&quot; -&gt; &quot;0x615cd6b0f1e0&quot;
&quot;0x615cd6b09b60&quot; -&gt; &quot;0x615cd6b0cdb0&quot;
&quot;0x615cd6b0b3e0&quot;[shape=ellipse, label=&quot;movement_phase&quot;, style=solid]
&quot;0x615cd6b0b3e0&quot; -&gt; &quot;0x615cd6b12f30&quot;
&quot;0x615cd6b0b3e0&quot; -&gt; &quot;0x615cd6b10950&quot;
&quot;0x615cd6b0b3e0&quot; -&gt; &quot;0x615cd6b0b4a0&quot;
&quot;0x615cd6b0b3e0&quot; -&gt; &quot;0x615cd6b10120&quot;
&quot;0x615cd6b0b4a0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6b0bc20&quot;[shape=box, label=&quot;end_move&quot;, style=solid]
&quot;0x615cd6b0bc20&quot; -&gt; &quot;0x615cd6b12f30&quot;
&quot;0x615cd6b0bc20&quot; -&gt; &quot;0x615cd6b10950&quot;
&quot;0x615cd6b0bc20&quot; -&gt; &quot;0x615cd6b0b4a0&quot;
&quot;0x615cd6b0bc20&quot; -&gt; &quot;0x615cd6b10120&quot;
&quot;0x615cd6b0cdb0&quot;[shape=box, label=&quot;use_gilded_spear&quot;, style=solid]
&quot;0x615cd6b0cdb0&quot; -&gt; &quot;0x615cd6b0f1e0&quot;
&quot;0x615cd6b0f1e0&quot;[shape=box, label=&quot;move&quot;, style=dotted]
&quot;0x615cd6b0f1e0&quot; -&gt; &quot;0x615cd6b12f30&quot;
&quot;0x615cd6b0f1e0&quot; -&gt; &quot;0x615cd6b10950&quot;
&quot;0x615cd6b0f1e0&quot; -&gt; &quot;0x615cd6b0b4a0&quot;
&quot;0x615cd6b0f1e0&quot; -&gt; &quot;0x615cd6b10120&quot;
&quot;0x615cd6b10120&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6b10120&quot; -&gt; &quot;0x615cd6b09b60&quot;
&quot;0x615cd6b10120&quot; -&gt; &quot;0x615cd6b0bc20&quot;
&quot;0x615cd6b10950&quot;[shape=box, label=&quot;reserve_deployment&quot;, style=dotted]
&quot;0x615cd6b10950&quot; -&gt; &quot;0x615cd6b12f30&quot;
&quot;0x615cd6b10950&quot; -&gt; &quot;0x615cd6b10950&quot;
&quot;0x615cd6b10950&quot; -&gt; &quot;0x615cd6b0b4a0&quot;
&quot;0x615cd6b12f30&quot;[shape=box, label=&quot;rapid_ingress&quot;, style=dotted]
&quot;0x615cd6b12f30&quot; -&gt; &quot;0x615cd6b0b4a0&quot;
&quot;0x615cd6b149c0&quot;[shape=ellipse, label=&quot;shooting_phase&quot;, style=solid]
&quot;0x615cd6b149c0&quot; -&gt; &quot;0x615cd6b14a80&quot;
&quot;0x615cd6b149c0&quot; -&gt; &quot;0x615cd6b1b270&quot;
&quot;0x615cd6b14a80&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6b15f20&quot;[shape=box, label=&quot;end_shooting_phase&quot;, style=solid]
&quot;0x615cd6b15f20&quot; -&gt; &quot;0x615cd6b14a80&quot;
&quot;0x615cd6b15f20&quot; -&gt; &quot;0x615cd6b1b270&quot;
&quot;0x615cd6b161b0&quot;[shape=box, label=&quot;select_target&quot;, style=solid]
&quot;0x615cd6b161b0&quot; -&gt; &quot;0x615cd6b1ab90&quot;
&quot;0x615cd6b1ab90&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6b1ab90&quot; -&gt; &quot;0x615cd6b14a80&quot;
&quot;0x615cd6b1ab90&quot; -&gt; &quot;0x615cd6b1b270&quot;
&quot;0x615cd6b1b270&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6b1b270&quot; -&gt; &quot;0x615cd6b161b0&quot;
&quot;0x615cd6b1b270&quot; -&gt; &quot;0x615cd6b15f20&quot;
&quot;0x615cd6a65e80&quot;[shape=box, label=&quot;fight_phase&quot;, style=dotted]
&quot;0x615cd6a65e80&quot; -&gt; &quot;0x615cd6b1b6b0&quot;
&quot;0x615cd6b1b4f0&quot;[shape=ellipse, label=&quot;turn&quot;, style=solid]
&quot;0x615cd6b1b4f0&quot; -&gt; &quot;0x615cd6b1bd30&quot;
&quot;0x615cd6b1b6b0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6b1bd30&quot;[shape=box, label=&quot;command_phase&quot;, style=dotted]
&quot;0x615cd6b1bd30&quot; -&gt; &quot;0x615cd6b1c1c0&quot;
&quot;0x615cd6b1c1c0&quot;[shape=box, label=&quot;movement_phase&quot;, style=dotted]
&quot;0x615cd6b1c1c0&quot; -&gt; &quot;0x615cd6b1c5e0&quot;
&quot;0x615cd6b1c5e0&quot;[shape=box, label=&quot;shooting_phase&quot;, style=dotted]
&quot;0x615cd6b1c5e0&quot; -&gt; &quot;0x615cd6b1dc80&quot;
&quot;0x615cd6b1dc80&quot;[shape=box, label=&quot;charge_phase&quot;, style=dotted]
&quot;0x615cd6b1dc80&quot; -&gt; &quot;0x615cd6a65e80&quot;
&quot;0x615cd6a664f0&quot;[shape=ellipse, label=&quot;round&quot;, style=solid]
&quot;0x615cd6a664f0&quot; -&gt; &quot;0x615cd6a66910&quot;
&quot;0x615cd6a665b0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a66910&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a66910&quot; -&gt; &quot;0x615cd6a66f80&quot;
&quot;0x615cd6a66f80&quot;[shape=box, label=&quot;&quot;, style=dotted]
&quot;0x615cd6a66f80&quot; -&gt; &quot;0x615cd6a665b0&quot;
&quot;0x615cd6a67610&quot;[shape=ellipse, label=&quot;attach_leaders&quot;, style=solid]
&quot;0x615cd6a67610&quot; -&gt; &quot;0x615cd6a6ff20&quot;
&quot;0x615cd6a67610&quot; -&gt; &quot;0x615cd6a67700&quot;
&quot;0x615cd6a67700&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a69880&quot;[shape=box, label=&quot;done_attaching&quot;, style=solid]
&quot;0x615cd6a69880&quot; -&gt; &quot;0x615cd6a6ff20&quot;
&quot;0x615cd6a69880&quot; -&gt; &quot;0x615cd6a67700&quot;
&quot;0x615cd6a6a540&quot;[shape=box, label=&quot;attack_character&quot;, style=solid]
&quot;0x615cd6a6a540&quot; -&gt; &quot;0x615cd6a6ff20&quot;
&quot;0x615cd6a6a540&quot; -&gt; &quot;0x615cd6a67700&quot;
&quot;0x615cd6a6ff20&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6a6ff20&quot; -&gt; &quot;0x615cd6a6a540&quot;
&quot;0x615cd6a6ff20&quot; -&gt; &quot;0x615cd6a69880&quot;
&quot;0x615cd6a71b70&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a75540&quot;[shape=ellipse, label=&quot;deploy&quot;, style=solid]
&quot;0x615cd6a75540&quot; -&gt; &quot;0x615cd6a8c390&quot;
&quot;0x615cd6a75540&quot; -&gt; &quot;0x615cd6a71b70&quot;
&quot;0x615cd6a76360&quot;[shape=box, label=&quot;select_unit&quot;, style=solid]
&quot;0x615cd6a76360&quot; -&gt; &quot;0x615cd6a781c0&quot;
&quot;0x615cd6a76710&quot;[shape=box, label=&quot;done_deploying&quot;, style=solid]
&quot;0x615cd6a76710&quot; -&gt; &quot;0x615cd6a8c390&quot;
&quot;0x615cd6a76710&quot; -&gt; &quot;0x615cd6a71b70&quot;
&quot;0x615cd6a781c0&quot;[shape=box, label=&quot;deploy_at&quot;, style=solid]
&quot;0x615cd6a781c0&quot; -&gt; &quot;0x615cd6a8c390&quot;
&quot;0x615cd6a781c0&quot; -&gt; &quot;0x615cd6a71b70&quot;
&quot;0x615cd6a8c390&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6a8c390&quot; -&gt; &quot;0x615cd6a76360&quot;
&quot;0x615cd6a8c390&quot; -&gt; &quot;0x615cd6a76710&quot;
&quot;0x615cd69dc8d0&quot;[shape=box, label=&quot;deploy&quot;, style=dotted]
&quot;0x615cd69dc8d0&quot; -&gt; &quot;0x615cd69dcf60&quot;
&quot;0x615cd69dc8d0&quot; -&gt; &quot;0x615cd6a8c610&quot;
&quot;0x615cd69dcf60&quot;[shape=box, label=&quot;round&quot;, style=dotted]
&quot;0x615cd69dcf60&quot; -&gt; &quot;0x615cd69dcf60&quot;
&quot;0x615cd69dcf60&quot; -&gt; &quot;0x615cd6a8c610&quot;
&quot;0x615cd6a8c580&quot;[shape=ellipse, label=&quot;battle&quot;, style=solid]
&quot;0x615cd6a8c580&quot; -&gt; &quot;0x615cd6a8d940&quot;
&quot;0x615cd6a8c610&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd6a8d940&quot;[shape=box, label=&quot;attach_leaders&quot;, style=dotted]
&quot;0x615cd6a8d940&quot; -&gt; &quot;0x615cd69dc8d0&quot;
&quot;0x615cd6924230&quot;[shape=diamond, label=&quot;&quot;, style=solid]
&quot;0x615cd6924230&quot; -&gt; &quot;0x615cd69e4050&quot;
&quot;0x615cd6924230&quot; -&gt; &quot;0x615cd6a92500&quot;
&quot;0x615cd6924230&quot; -&gt; &quot;0x615cd6a8f180&quot;
&quot;0x615cd6924230&quot; -&gt; &quot;0x615cd6a8fa10&quot;
&quot;0x615cd6924230&quot; -&gt; &quot;0x615cd6a91c70&quot;
&quot;0x615cd6924230&quot; -&gt; &quot;0x615cd6a912b0&quot;
&quot;0x615cd69dddd0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd69e3c90&quot;[shape=ellipse, label=&quot;pick_army&quot;, style=solid]
&quot;0x615cd69e3c90&quot; -&gt; &quot;0x615cd6924230&quot;
&quot;0x615cd69e4050&quot;[shape=box, label=&quot;pick_strike_force_octavious&quot;, style=solid]
&quot;0x615cd69e4050&quot; -&gt; &quot;0x615cd69dddd0&quot;
&quot;0x615cd6a8f180&quot;[shape=box, label=&quot;pick_insidious_infiltrators&quot;, style=solid]
&quot;0x615cd6a8f180&quot; -&gt; &quot;0x615cd69dddd0&quot;
&quot;0x615cd6a8fa10&quot;[shape=box, label=&quot;pick_zarkan_deamonkin&quot;, style=solid]
&quot;0x615cd6a8fa10&quot; -&gt; &quot;0x615cd69dddd0&quot;
&quot;0x615cd6a912b0&quot;[shape=box, label=&quot;pick_morgrim_butcha&quot;, style=solid]
&quot;0x615cd6a912b0&quot; -&gt; &quot;0x615cd69dddd0&quot;
&quot;0x615cd6a91c70&quot;[shape=box, label=&quot;pick_tristean_gilded_blade&quot;, style=solid]
&quot;0x615cd6a91c70&quot; -&gt; &quot;0x615cd69dddd0&quot;
&quot;0x615cd6a92500&quot;[shape=box, label=&quot;pick_vengeful_brethren&quot;, style=solid]
&quot;0x615cd6a92500&quot; -&gt; &quot;0x615cd69dddd0&quot;
&quot;0x615cd690e7a0&quot;[shape=ellipse, label=&quot;play&quot;, style=solid]
&quot;0x615cd690e7a0&quot; -&gt; &quot;0x615cd697d820&quot;
&quot;0x615cd6979fa0&quot;[shape=ellipse, label=&quot;ret&quot;, style=solid]
&quot;0x615cd697d820&quot;[shape=box, label=&quot;p1&quot;, style=dotted]
&quot;0x615cd697d820&quot; -&gt; &quot;0x615cd697f550&quot;
&quot;0x615cd697f550&quot;[shape=box, label=&quot;p2&quot;, style=dotted]
&quot;0x615cd697f550&quot; -&gt; &quot;0x615cd697f9f0&quot;
&quot;0x615cd697f9f0&quot;[shape=box, label=&quot;battle&quot;, style=dotted]
&quot;0x615cd697f9f0&quot; -&gt; &quot;0x615cd6979fa0&quot;
 }" class="graphviz" /></div>
</section>
<section id="rolling-a-die">
<h3>Rolling a Die<a class="headerlink" href="#rolling-a-die" title="Link to this heading"></a></h3>
<p>To better understand the complexity of interactive sequences in <strong>Warhammer 40,000</strong>, let’s focus on the <strong>simplest</strong> one: <strong>rolling a die</strong>. Even this basic action involves a surprising amount of logic and variability.</p>
<section id="core-rules">
<h4>Core Rules<a class="headerlink" href="#core-rules" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Dice typically have <strong>3 or 6 faces</strong>.</p></li>
<li><p>A <strong>non-rerollable roll</strong> is atomic:
A random number between <code class="docutils literal notranslate"><span class="pre">1</span></code> and the number of faces is generated, and the game sequence that triggered the roll resumes.</p></li>
<li><p>A <strong>rerollable die</strong> involves additional logic:</p>
<ul>
<li><p>It begins with a non-rerollable roll.</p></li>
<li><p>Depending on the current game state, the player may be <strong>offered the option</strong> to reroll.</p></li>
<li><p>If rerolled, the <strong>second result must be kept</strong>.
(This distinguishes it from rules like “roll two dice and pick the best.”)</p></li>
</ul>
</li>
</ul>
</section>
<section id="variants-of-rerolling">
<h4>Variants of Rerolling<a class="headerlink" href="#variants-of-rerolling" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Sometimes the die may be <strong>rerolled for free</strong>.</p></li>
<li><p>Sometimes the player may reroll <strong>for free</strong>, but <strong>only if the result is a 1</strong>.</p></li>
<li><p>Sometimes the player may reroll <strong>by spending a command point</strong> (a limited in-game resource).</p></li>
<li><p><strong>Only one command-point-based reroll</strong> is allowed per phase—after it’s used, no more rerolls of that type are allowed.</p></li>
<li><p>The player must know:</p>
<ul>
<li><p>The <strong>result of the initial roll</strong> before deciding to reroll.</p></li>
<li><p>Whether the <strong>reroll costs a command point</strong>.</p></li>
<li><p>Whether the <strong>command point has already been spent</strong>.</p></li>
</ul>
</li>
</ul>
<p>This information must be <strong>visible to the user</strong> during interaction.</p>
</section>
<section id="additional-requirements-from-4hammer">
<h4>Additional Requirements from 4Hammer<a class="headerlink" href="#additional-requirements-from-4hammer" title="Link to this heading"></a></h4>
<p>Because of 4Hammer’s goals, the dice roll sequence must satisfy additional constraints:</p>
<ul class="simple">
<li><p>✅ <strong>Suspendable</strong>: Can wait for user input (e.g., for reroll decisions).</p></li>
<li><p>✅ <strong>Validated</strong>: Rejects invalid arguments at runtime.</p></li>
<li><p>✅ <strong>Reinforcement Learning-Compatible</strong>: Must be convertible to a format suitable for RL training.</p></li>
<li><p>✅ <strong>Text-Encodable</strong>: Can be converted to a readable textual representation.</p></li>
<li><p>✅ <strong>Inspectable</strong>: The final result of the roll must be stored and accessible (e.g., for UI rendering).</p></li>
</ul>
<p>The following graph shows the how the control flow may evolve when rolling a die.</p>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-7f11237fc67d8cdea7e2a54a51757771e0f00e2a.png" alt="Figure made with TikZ" /></p>
</div><p>This is the simplest interactive sequence of the game, which is then reused in multiple points across the program.</p>
<p>If you are new to Rulebook, stop for a second thinking how you would implement a program that meets all requirements.</p>
</section>
<section id="cpp-implementation">
<h4>CPP Implementation<a class="headerlink" href="#cpp-implementation" title="Link to this heading"></a></h4>
<p>The following code is the cpp implementation that achieves all requirements stated in the previous <a class="reference internal" href="#rolling-a-die"><span class="xref myst">section</span></a>.</p>
<p>To make the comparison more fair we have omitted all serialization methods that would require to be hand written in cpp, which could be generated in other languages such as python. Similarly we have removed all empty lines and put comments next to each line of code, so that we don’t get accused of trying to inflate the code size. The code has been written in a style similar to <a class="reference external" href="https://en.wikipedia.org/wiki/Automata-based_programming">automata base programming</a> which is a well know way of writing state machines in c and cpp. The implementation is mandatory, you cannot use CPP20 coroutines because they have no mechanism for precondition checking, or state inspection.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RerrolableRoll</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w"> </span><span class="c1">// data to require to serialize and restore the state</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">suspensionPoint</span><span class="p">;</span><span class="w"> </span><span class="c1">// keeps track of what is the current point of the sequence</span>
<span class="w">    </span><span class="n">Dice</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"> </span><span class="c1">// the final result of the roll</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_reroll</span><span class="p">;</span><span class="w"> </span><span class="c1">// can reroll for free</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_reroll_1s</span><span class="p">;</span><span class="w"> </span><span class="c1">// can reroll 1s for free</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_cp_reroll</span><span class="p">;</span><span class="w"> </span><span class="c1">// can reroll by paying a command point</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_non_cp_rerollable</span><span class="p">;</span><span class="w"> </span><span class="c1">//it is rerollable in a way that does not cost a cp</span>
<span class="w">    </span><span class="n">Bool</span><span class="w"> </span><span class="n">current_player</span><span class="p">;</span><span class="w"> </span><span class="c1">// the player that is performing the roll, bool is fine since it is a two player game</span>
<span class="w">    </span><span class="n">RerollebleRoll</span><span class="p">(</span><span class="w"> </span><span class="c1">// constructor that starts the sequence</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_reroll</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_reroll_1s</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_cp_reroll</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_non_cp_rerollable</span><span class="p">,</span>
<span class="w">        </span><span class="n">Bool</span><span class="w"> </span><span class="n">current_player</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">suspension_point</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="n">can_reroll</span><span class="p">(</span><span class="n">can_reroll</span><span class="p">),</span>
<span class="w">        </span><span class="n">can_reroll_1s</span><span class="p">(</span><span class="n">can_reroll_1s</span><span class="p">),</span>
<span class="w">        </span><span class="n">can_cp_reroll</span><span class="p">(</span><span class="n">can_cp_reroll</span><span class="p">),</span>
<span class="w">        </span><span class="n">is_non_cp_rerollable</span><span class="p">(</span><span class="n">is_non_cp_rerollable</span><span class="p">),</span>
<span class="w">        </span><span class="n">current_player</span><span class="p">(</span><span class="n">current_player</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">roll</span><span class="p">(</span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">Dice</span><span class="w"> </span><span class="n">dice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">can_roll</span><span class="p">(</span><span class="n">state</span><span class="p">),</span><span class="w"> </span><span class="n">sate</span><span class="p">);</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dice</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"> </span><span class="c1">// if this is the first time we roll the dice</span>
<span class="w">            </span><span class="n">is_non_cp_rerollable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can_reroll</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="p">(</span><span class="n">can_reroll_1s</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// figure out if we can reroll for free</span>
<span class="w">            </span><span class="n">is_cp_rerollable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cp_rerollable</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">board</span><span class="p">.</span><span class="n">can_use_strat</span><span class="p">(</span><span class="n">current_player</span><span class="p">,</span><span class="w"> </span><span class="n">Stratagem</span><span class="o">::</span><span class="n">reroll</span><span class="p">)</span><span class="w"> </span><span class="c1">// figure out if the player has already rerolled a dice this phase</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_non_cp_rerollable</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">is_cp_rerollable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if we can reroll in any way</span>
<span class="w">                </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// the next state is waiting for the user decision</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// otherwise we are done</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if it is the second roll</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_non_cp_rerollable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if the roll was not free</span>
<span class="w">                </span><span class="n">board</span><span class="p">.</span><span class="n">consume_command_point</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dice</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_roll</span><span class="p">(</span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">Dice</span><span class="w"> </span><span class="n">dice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// actions have no precondition, so we just need to check if the resume index is the associated to the first or second roll</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">keep_it</span><span class="p">(</span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">Bool</span><span class="w"> </span><span class="n">do_it</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">can_keep_it</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">dice</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">do_it</span><span class="p">)</span>
<span class="w">            </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// goes to the second roll</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// goes to the end</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_keep_it</span><span class="p">(</span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">Bool</span><span class="w"> </span><span class="n">do_it</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">suspensionPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ActionRoll</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// a class that rappresents a action, in a way that can be stored and executed later</span>
<span class="w">        </span><span class="n">Dice</span><span class="w"> </span><span class="n">roll</span><span class="p">;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">RerollableDiceRoll</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="n">rollBeingResolved</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">roll</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">can_apply</span><span class="p">(</span><span class="n">RerollableDiceRoll</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">.</span><span class="n">can_roll</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">roll</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ActionKeepIt</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">do_it</span><span class="p">;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">RerollableDiceRoll</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="n">rollBeingResolved</span><span class="p">.</span><span class="n">keep_it</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">do_it</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">can_apply</span><span class="p">(</span><span class="n">RerollableDiceRoll</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">.</span><span class="n">do_it</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">do_it</span><span class="p">);</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">AnyRerollableDiceRollAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">ActionRoll</span><span class="p">,</span><span class="w"> </span><span class="n">ActionKeepIt</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// a union between all possible actions so that they stored in a single cpp vector without inheritance</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">AnyRerollableDiceRollAction</span><span class="o">&amp;</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">RerollableDiceRoll</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">){</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">apply</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">activeAlternative</span><span class="p">){</span><span class="w"> </span><span class="n">activeAlternative</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">self</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_apply</span><span class="p">(</span><span class="n">AnyRerollableDiceRollAction</span><span class="o">&amp;</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">RerollableDiceRoll</span><span class="w"> </span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">){</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">apply</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">activeAlternative</span><span class="p">){</span><span class="w"> </span><span class="n">activeAlternative</span><span class="p">.</span><span class="n">can_apply</span><span class="p">(</span><span class="n">rollBeingResolved</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">self</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The code stores all the variables required to suspend the execution in the class body, then exposes 2 function for each action that can be performed. One to check if the action is valid, one to execute it. The functions that performs the actions contain a handrolled state machine. Finally, to be able to delay execution of actions, they are wrapped as well into a class. Even without all the serialization functions that have been omitted and can sometimes be generated in other languages, there is strong coupling between various components of the system, and modifying this implementation without breaking it is hard. Languages like python may save you the union at the cost of runtime performance, but most of the code just shown is mandatory in almost every imperative language. There is a logical error in the code. Did you spot it?</p>
<p>Here is the implementation in Rulebook instead</p>
</section>
<section id="rulebook-implementation">
<h4>Rulebook Implementation<a class="headerlink" href="#rulebook-implementation" title="Link to this heading"></a></h4>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="kn">act</span> <span class="n">rerollable_dice_roll</span><span class="p">(</span><span class="kn">ctx</span> <span class="nc">Board</span> <span class="n">board</span><span class="p">,</span>
                         <span class="kn">frm</span> <span class="nc">Bool</span> <span class="n">reroll</span><span class="p">,</span>
                         <span class="kn">frm</span> <span class="nc">Bool</span> <span class="n">reroll_1s</span><span class="p">,</span>
                         <span class="kn">frm</span> <span class="nc">Bool</span> <span class="n">cp_rerollable</span><span class="p">,</span>
                         <span class="kn">frm</span> <span class="nc">Bool</span> <span class="n">current_player</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">RerollableDice</span><span class="p">:</span>
    <span class="c1"># sets the value for the rolled dice</span>
    <span class="kn">act</span> <span class="n">roll</span><span class="p">(</span><span class="kn">frm</span> <span class="nc">Dice</span> <span class="n">result</span><span class="p">)</span>
    <span class="kn">frm</span> <span class="n">is_non_cp_rerollable</span> <span class="o">=</span> <span class="n">reroll</span> <span class="o">or</span> <span class="p">(</span><span class="n">reroll_1s</span> <span class="o">and</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kr">let</span> <span class="n">is_cp_rerollable</span> <span class="o">=</span> <span class="n">cp_rerollable</span> <span class="o">and</span> <span class="n">board</span><span class="p">.</span><span class="n">can_use_strat</span><span class="p">(</span><span class="n">current_player</span><span class="p">,</span> <span class="nc">Stratagem</span><span class="p">::</span><span class="n">reroll</span><span class="p">)</span>
    <span class="kr">if</span> <span class="o">!</span><span class="n">is_non_cp_rerollable</span> <span class="o">and</span> <span class="o">!</span><span class="n">is_cp_rerollable</span><span class="p">:</span>
        <span class="kr">return</span>
    <span class="c1"># reject the possibility of rerolling the dice and keep the current result</span>
    <span class="kn">act</span> <span class="n">keep_it</span><span class="p">(</span><span class="nc">Bool</span> <span class="n">do_it</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">do_it</span><span class="p">:</span>
        <span class="kr">return</span>
    <span class="c1"># resets the rolled value</span>
    <span class="kn">act</span> <span class="n">reroll</span><span class="p">(</span><span class="nc">Dice</span> <span class="n">new_value</span><span class="p">)</span>
    <span class="kr">if</span> <span class="o">!</span><span class="n">is_non_cp_rerollable</span><span class="p">:</span>
        <span class="n">board</span><span class="p">.</span><span class="n">spend_command_point</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">new_value</span>
</pre></div>
</div>
<p>This implementation generates a series of classes that are equivalent to the cpp ones, including all serializers that have been omitted before. You can notice there is no coupling between any part of the system, and modifying the code to add another action or another condition would only require local changes.</p>
<p>Furthermore, the cpp code would still need glue before it can be run in a fuzzer or a machine learning infrastructure, we get it for free.</p>
<p>Remember this is the simplest interactive sequence of the game. Sequences such as performing a single attack resolution from one of the models explode in complexity and I don’t think i would be able to write the cpp code by hand without committing multiple mistakes.</p>
</section>
</section>
</section>
<section id="software-architecture">
<h2>Software architecture<a class="headerlink" href="#software-architecture" title="Link to this heading"></a></h2>
<p>Here is the architecture of our example project <a class="reference external" href="https://github.com/rl-language/4Hammer">4hammer</a>. 4Hammer is a <a class="reference external" href="https://godotengine.org">godot</a> based reinforcement learning environments. What is relevant to this section is that:</p>
<ul class="simple">
<li><p>4Hammer has a architecture and usecase similar to other graphical engine programs, such as videogames.</p></li>
<li><p>Rulebook code is invoked by godot scripts, so that godot can decide what to render on screen.</p></li>
<li><p>Rulebook code is used by python reinforcement learning scripts to maximize arbitrary objectives.</p></li>
</ul>
<div class="figure" style="text-align: center"><p><img  src="_images/tikz-506dfc568dc3bf1b967c0ca5467239360de6b5bc.png" alt="Figure made with TikZ" /></p>
</div><p>Rulebook code(red) describing the rules of the environment is compiled into a shared library(lib.so) using RLC. RLC emits as well a wrapper for Python(wrapper.py) and for Godot(godot_header.h).</p>
<section id="hammer-graphical-engine">
<h3>4Hammer graphical engine<a class="headerlink" href="#hammer-graphical-engine" title="Link to this heading"></a></h3>
<p>The Godot wrapper and simulation rules are used to compile a Godot plugin, which exposes Rulebook typesafe rules, types and functions to godot scripts.</p>
<p>The godot plugin and the godot graphical elements are exported by the godot editor to produce 4hammer_graphical_engine  which is the final product that can be used by users as a standalone application. Since godot can run on the web, and rlc exports webassembly files too, you can use 4hammer_graphical_engine on the web too.</p>
</section>
<section id="python-drivers">
<h3>Python drivers<a class="headerlink" href="#python-drivers" title="Link to this heading"></a></h3>
<p>The rulebook code is as well executed by python scripts that load the wrapper and the library.
Since the rules are the same between the engine and python, python can connect over network to the engine and issue commands related to rulebook components.</p>
</section>
<section id="fuzzer">
<h3>Fuzzer<a class="headerlink" href="#fuzzer" title="Link to this heading"></a></h3>
<p>The rulebook libraries have been designed to expose a <a class="reference internal" href="#./language_tour.html#finite-interactive-programs"><span class="xref myst">finite interactive program</span></a>. This allows to automatically compile a <a class="reference internal" href="#./language_tour.html#automatic-testing"><span class="xref myst">fuzzer</span></a>, which stresses the controller of the environment for free.</p>
</section>
</section>
<section id="self-configuring-ui">
<h2>Self configuring UI<a class="headerlink" href="#self-configuring-ui" title="Link to this heading"></a></h2>
<p>One of the objective of the Rulebook is to be able to modify rules and have the UI automatically adapt to them. We achieve this using the language <a class="reference internal" href="language_tour.html#action-statements-classes"><span class="std std-ref">action classes</span></a>. Here is a example, the godot script that handles the <a class="reference external" href="https://github.com/rl-language/4Hammer/blob/master/scripts/boardl.gd#L22">game board</a> so that whenever a action related to selecting the board is possible, the elegible locations glow yellow.</p>
<div class="highlight-godot notranslate"><div class="highlight"><pre><span></span># triggers after every action
func on_state_changed():
	for quad in quads.values():
		quad.visible = false
    # for all actions that can be taken
	for action in GlobalRules.valid_actions:
		var unwrapped = action.unwrap() # the the raw valid action
		if unwrapped.members_count() != 1: # if has not exactly one argument we don&#39;t know what the semantics are, we will ignore it.
			continue
		if not unwrapped.get_member(0) is RLCBoardPosition: # if the only argument is not a RLCBoardPosition we don&#39;t know the semantics
			continue
		var board_position = unwrapped.get_member(0) as RLCBoardPosition # otherwise it is a action that accepts a board position
		if not board_position:
			continue
        # highlight that board position for the user to click
		quads[board_position.get_x().get_value() * 100 + board_position.get_y().get_value()].visible = true
</pre></div>
</div>
<p>The UI only can introspect valid actions, make sure that they have the expected shape of only requring a single <code class="docutils literal notranslate"><span class="pre">BoardPosition</span></code> argument, and then highlight that particular board location.</p>
<p>This meas that the rule writer can write rules such as the current implementation of moving a game piece on the board</p>
<div class="highlight-rlc notranslate"><div class="highlight"><pre><span></span><span class="c1"># core rules movement rules, including the possiblity</span>
<span class="c1"># of advancing and the triggering of overwatches</span>
<span class="kn">act</span> <span class="n">move</span><span class="p">(</span><span class="kn">ctx</span> <span class="nc">Board</span> <span class="n">board</span><span class="p">,</span> <span class="kn">ctx</span> <span class="nc">UnitID</span> <span class="n">unit</span><span class="p">,</span> <span class="kn">frm</span> <span class="nc">StatModifier</span> <span class="n">additional_movement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Move</span><span class="p">:</span>
    <span class="kr">if</span> <span class="n">board</span><span class="p">[</span><span class="n">unit</span><span class="p">.</span><span class="n">get</span><span class="p">()].</span><span class="n">models</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="kr">return</span>
    <span class="n">board</span><span class="p">.</span><span class="n">current_decision_maker</span> <span class="o">=</span> <span class="n">board</span><span class="p">.</span><span class="n">current_player</span>
    <span class="kn">act</span> <span class="n">move_to</span><span class="p">(</span><span class="nc">BoardPosition</span> <span class="n">position</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">as_vector</span><span class="p">()</span> <span class="o">-</span> <span class="n">board</span><span class="p">[</span><span class="n">unit</span><span class="p">.</span><span class="n">get</span><span class="p">()][</span><span class="mi">0</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">as_vector</span><span class="p">()).</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">float</span><span class="p">(</span><span class="n">board</span><span class="p">[</span><span class="n">unit</span><span class="p">.</span><span class="n">get</span><span class="p">()][</span><span class="mi">0</span><span class="p">].</span><span class="n">profile</span><span class="p">.</span><span class="n">movement</span><span class="p">()</span> <span class="o">+</span> <span class="n">additional_movement</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="p">...</span>
</pre></div>
</div>
<p>Without knowing anything related to the UI, the user declared a <code class="docutils literal notranslate"><span class="pre">move_to</span></code> action, never referenced by any godot specific code. Since it accepts a <code class="docutils literal notranslate"><span class="pre">BoardPosion</span></code>, it is auto detected by the UI code.</p>
<p>Of course, this is very inefficient. In practice it does not matter since the objective of 4hammer is not to draw billions of polygons on screen, but it one wished to make it more efficient it could have enumerated all possible types of valid actions instead of introspecting actions at run time, and then checked if those particular actions where valid.</p>
<p>A even more efficient, but less flexible implementation would have been to to directly invoke a call back from RLC code yielding the most optimal implementation, but that would require some extra trickery to make sure machine learning stuff still works.</p>
<section id="supported-autoconfigurations">
<h3>Supported autoconfigurations<a class="headerlink" href="#supported-autoconfigurations" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>all actions that accepts a single BoardPosition are interpreted as the user being allowed to click on the board.</p></li>
<li><p>all actions that accept a UnitID are interpred as the user wishing to click on a unit. All valid units glow and can be clicked.</p></li>
<li><p>all actions taht accept a ModelID display the model glowing and allow the user to click on it. The rule writer must specify which unit that model belongs to, to be able to tell them apart.</p></li>
<li><p>all actions that accepts 2 UnitID are interpretd as the user wishing to make interact the first unit with the second unit. For example shooting with a unit onto another. The UI allows to drag a arrow from the start unit torward the target unit.</p></li>
<li><p>actions that accept a single bool display to the user the name of the action phraased as a question.</p></li>
<li><p>actions that accept a enum display the valid choises on screen for the player to select.</p></li>
</ul>
</section>
</section>
<section id="remote-execution">
<h2>Remote execution<a class="headerlink" href="#remote-execution" title="Link to this heading"></a></h2>
<p>Since the entirety of the game rules are writte into Rulebook action functions, we obtain for free remote execution. <a class="reference external" href="https://github.com/rl-language/4Hammer/blob/master/scripts/server.gd#L1">Here</a> is the trivial implementation of the server component on the side of godot, that waits for connections that then issue server commands. Some special server commands are handle nativelly by godot, such as exfiltrating the current image on screen and send it over network or stopping the rendering of the screen entirelly.</p>
<p>Every other action is simply a rulebook action implied by the rules of the game. Every time a rule programmer changes one of those rules, the remote execution mechanism updates itself automatically. Furthermore, since the network is issuing commands exactly like in process graphical elements are, the only thing that cannot be tested over network is the act on interacting on ui elements themselves.</p>
</section>
<section id="id1">
<h2>Python drivers<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>Since we have remote execution, and Rulebook emits wrappers for other languages, we have the ability to use python to perform typical activities that you may wish to do in reinforcement learning or game programming, beside of course all those that we get off-the-shelf with <a class="reference internal" href="rlc.html"><span class="std std-doc">RLC</span></a>.</p>
<p><a class="reference external" href="https://github.com/rl-language/4Hammer/blob/master/examples/engine_driver.py">Here</a> is a possible implementation of the remote execution mechanism on the side of the client, say python, that knows the full rules too! <a class="reference external" href="https://github.com/rl-language/4Hammer/blob/master/examples/graphical_engine_driver.py">You can see it</a> used in practice in a example that plays out at random the game over network.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ui_gameplay.html" class="btn btn-neutral float-left" title="UI, Controller, and Gameplay" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="language-reference.html" class="btn btn-neutral float-right" title="Rulebook Language" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Massimo Fioravanti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>